<div fxLayout="row" fxLayoutAlign="space-between">
	<span mat-dialog-title [translate]="'ambulatoria.paciente.nueva-consulta.studies.dialog.TITLE'"></span>
	<button mat-icon-button (click)="close()">
		<mat-icon>close</mat-icon>
	</button>
</div>

<mat-stepper linear #stepper>
	<form [formGroup]="form" class="form">
		<mat-step [completed]="this.form.controls.healthProblem.valid">
			<ng-template matStepLabel> {{'ambulatoria.paciente.nueva-consulta.studies.dialog.PATIENT_DATA' |
				translate}}
			</ng-template>

			<mat-dialog-content>
				<div fxLayoutGap="10px" fxLayout="column">

					<div fxLayoutGap="10px">
						<h2> {{'ambulatoria.paciente.nueva-consulta.studies.dialog.PATIENT_DATA' |
							translate}}</h2>
						<app-patient-summary *ngIf="patient" [person]="patient" [size]="size">
						</app-patient-summary>
					</div>

					<div>
						<span>{{'ambulatoria.paciente.nueva-consulta.studies.dialog.MEDICAL_COVERAGE'
							| translate}}</span>
						<mat-form-field appearance="outline" class="full-width">

							<mat-select formControlName="patientMedicalCoverage"
								placeholder="{{'ambulatoria.paciente.nueva-consulta.studies.dialog.SELECT_MEDICAL_COVERAGE' | translate}}">
								<mat-option id="medical-coverage" name="medicalCoverage"
									*ngFor="let patientMedicalCoverage of patientMedicalCoverages"
									[value]="patientMedicalCoverage">
									{{ patientMedicalCoverage | fullMedicalCoverage }}
								</mat-option>
								<mat-divider></mat-divider>
								<mat-option (click)="openMedicalCoverageDialog()">
									<span class="color-primary"
										[translate]="'ambulatoria.paciente.nueva-consulta.studies.dialog.UPDATE_COVERAGE'"></span>
								</mat-option>
							</mat-select>
							<button id="clear-medical-coverage" type="button" *ngIf="form.value.patientMedicalCoverage"
								matSuffix color="warn" mat-icon-button
								(click)="clear(form.controls.patientMedicalCoverage); $event.stopPropagation()">
								<mat-icon>close</mat-icon>
							</button>
						</mat-form-field>

						<span> {{'ambulatoria.paciente.nueva-consulta.studies.dialog.HEALTH_PROBLEM' |
							translate}}
						</span>
						<mat-form-field appearance="outline" class="full-width">
							<mat-select formControlName="healthProblem" id="healthproblem">
								<mat-option *ngFor="let healthProblem of healthProblemOptions" [value]="healthProblem" (click)="setProblem(healthProblem)">
									{{ healthProblem.pt | translate }}
								</mat-option>
							</mat-select>
							<mat-error [translate]="'forms.REQUIRED'"></mat-error>
						</mat-form-field>
					</div>
				</div>

			</mat-dialog-content>

			<mat-dialog-actions class="dialog-actions" fxLayout="row" fxLayoutAlign="end start">
				<button mat-raised-button mat-button matStepperNext color="primary">
					{{'ambulatoria.paciente.nueva-consulta.studies.dialog.NEXT'|translate}}
				</button>
			</mat-dialog-actions>
		</mat-step>

		<mat-step>
			<ng-template matStepLabel>{{'ambulatoria.paciente.nueva-consulta.studies.dialog.STUDIES_LABEL' | translate}}</ng-template>

			<mat-dialog-content>
				<h2> {{'ambulatoria.paciente.nueva-consulta.studies.dialog.STUDIES_LABEL' |
							translate}}</h2>
				<app-create-order [data]="data" [studyCategoryOptions]="studyCategoryOptions"
					[problems]="data.problems"></app-create-order>

			</mat-dialog-content>

			<mat-dialog-actions fxLayoutAlign="end center" fxLayoutAlign="space-between center">
				<button mat-raised-button mat-button color="primary" matStepperPrevious>Volver</button>
				<button [disabled]="!data.createOrderService.firstPartAreCompleted" id="next" mat-raised-button
					matStepperNext color="primary">
					<span class="uppercase"> {{'historia-clinica.add_procedure.NEXT' | translate}}</span>
				</button>
			</mat-dialog-actions>
		</mat-step>

		<mat-step>
			<ng-template matStepLabel>{{'historia-clinica.add_procedure.RESULT' | translate}}</ng-template>

			<div *ngIf="data.createOrderService.firstPartAreCompleted">

				<div>
					<h1>{{'historia-clinica.add_procedure.TITLE_OPTIONS' | translate}} </h1>

					<mat-dialog-content class="no-scroll">
						<mat-radio-group [formControl]="radioControl.controls.controlButton" aria-label="Select an option" fxLayout="column"
							fxLayoutGap="15px" (change)="setCreationStatus($event)">
							<mat-radio-button [value]=study_status.FINAL>
								{{'historia-clinica.add_procedure.FINAL' | translate}}
							</mat-radio-button>
							<mat-radio-button [value]=study_status.REGISTERED>
								{{'historia-clinica.add_procedure.REGISTERED'|translate}}
							</mat-radio-button>
							<mat-radio-button [disabled]="!(data.createOrderService.hasTemplate$ | async)"
								[value]=completeNow>
								{{'historia-clinica.add_procedure.LOAD_RESULTS_NOW' | translate}}
							</mat-radio-button>
						</mat-radio-group>

					</mat-dialog-content>
				</div>

				<mat-dialog-actions fxLayoutAlign="end center" class="margin-top" fxLayoutAlign="space-between center">
					<button mat-raised-button mat-button color="primary" matStepperPrevious>
						{{'historia-clinica.add_procedure.CAME_BACK' | translate}}</button>

					<div *ngIf="(radioControl.controls.controlButton.value !== null )">
						<div
							*ngIf="((data.createOrderService.hasTemplate$ | async) && (radioControl.controls.controlButton.value === completeNow)) else buttonNext">

							<button [disabled]="!data.createOrderService.firstPartAreCompleted" id="next"
								mat-raised-button matStepperNext color="primary">
								<span class="uppercase"> {{'historia-clinica.add_procedure.NEXT' | translate}}</span>
							</button>
						</div>
						<ng-template #buttonNext>
							<div *ngIf="data.createOrderService.hasConcept()">

								<button id="add_order" mat-raised-button mat-button matStepperNext color="primary"
									(click)="addOrder()" class="uppercase">
									<span class="uppercase">{{'historia-clinica.add_procedure.ADD_PROCEDURE' |
										translate}}</span>
								</button>
							</div>
						</ng-template>
					</div>
				</mat-dialog-actions>
			</div>
		</mat-step>

		<mat-step *ngIf="(data.createOrderService.hasTemplate$ | async) && (radioControl.controls.controlButton.value === completeNow)">
			<mat-dialog-content>
				<ng-template matStepLabel>{{'historia-clinica.add_procedure.RESULTS_UPLOAD' | translate}}</ng-template>

				<div>
					<app-custom-form [templates]="data.createOrderService.templates"
						[createOrderService]="data.createOrderService">
					</app-custom-form>
				</div>
			</mat-dialog-content>

			<mat-dialog-actions fxLayoutAlign="end center" class="margin-top" fxLayoutAlign="space-between center">
				<button mat-raised-button mat-button color="primary" matStepperPrevious>Volver</button>

				<button [disabled]="!data.createOrderService.isValidForm()" id="add_order" mat-raised-button mat-button
					matStepperNext color="primary" (click)="addOrder()" class="uppercase">
					<span class="uppercase">{{'historia-clinica.add_procedure.COMPLETE' | translate}}</span>
				</button>
			</mat-dialog-actions>
		</mat-step>
	</form>
</mat-stepper>
