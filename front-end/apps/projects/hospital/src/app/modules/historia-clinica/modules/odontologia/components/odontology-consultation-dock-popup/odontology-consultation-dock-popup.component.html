<app-dock-popup [dockPopupRef]="dockPopupRef" [title]="'odontologia.nueva-consulta.TITLE'">

	<div body fxLayout="column" fxLayoutGap="20px">

		<div id="reasons">

			<app-new-document-section [sectionTitle]="'odontologia.nueva-consulta.motivo.TITLE'"
									  [sectionImportance]="'odontologia.nueva-consulta.RECOMENDADO'">

				<ng-container concept-form>

					<app-concepts-search
						*ngIf="!reasonNewConsultationService.getSnomedConcept() else mainReasonConsultation"
						[label]="'odontologia.nueva-consulta.motivo.MOTIVO'"
						(search)="reasonNewConsultationService.openSearchDialog($event)">
					</app-concepts-search>

					<ng-template #mainReasonConsultation>
						<form [formGroup]="reasonNewConsultationService.getForm()"
							  (ngSubmit)="reasonNewConsultationService.addToList()">
							<mat-form-field appearance="outline">
								<mat-label [translate]="'internaciones.anamnesis.diagnosticos.DIAGNOSIS'">
								</mat-label>
								<input id="reason_input" matInput type="text" formControlName="snomed" name="snomed"
									   readonly matTooltip="{{reasonNewConsultationService.getSnomedConcept().pt }}">
								<button id="clear_reasons" mat-button matSuffix color="warn" mat-icon-button
										(click)="reasonNewConsultationService.resetForm()">
									<mat-icon>close</mat-icon>
								</button>
							</mat-form-field>
							<div align="end">
								<button id="submit_reasons" class="uppercase" mat-raised-button color="primary"
										type="submit">
									<span class="uppercase"> Agregar motivo </span>
								</button>
							</div>
						</form>
					</ng-template>
				</ng-container>

				<app-document-section-table data-display [tableTitle]="'odontologia.nueva-consulta.motivo.table.TITLE'"
											[columns]="reasonNewConsultationService.getTableColumnConfig()"
											[data]="reasonNewConsultationService.getMotivosConsulta()">

				</app-document-section-table>

			</app-new-document-section>
		</div>

		<div id="allergies">
			<app-new-document-section sectionTitle="odontologia.nueva-consulta.alergias.TITLE">

				<ng-container concept-form>
					<app-concepts-search
						*ngIf="!allergiesNewConsultationService.getSnomedConcept() else allergiesForm"
						[label]="'odontologia.nueva-consulta.alergias.ALLERGY'"
						(search)="allergiesNewConsultationService.openSearchDialog($event)">
					</app-concepts-search>
					<ng-template #allergiesForm>
						<form [formGroup]="allergiesNewConsultationService.getForm()"
							  (ngSubmit)="allergiesNewConsultationService.addToList()">
							<mat-form-field appearance="outline">
								<mat-label [translate]="'odontologia.nueva-consulta.alergias.ALLERGY'">
								</mat-label>
								<input id="allergies_input" matInput type="text" formControlName="snomed" name="snomed"
									   readonly matTooltip="{{allergiesNewConsultationService.getSnomedConcept().pt }}">
								<button id="clear_allergies" mat-button matSuffix color="warn" mat-icon-button
										(click)="allergiesNewConsultationService.resetForm()">
									<mat-icon>close</mat-icon>
								</button>
							</mat-form-field>

							<mat-form-field appearance="outline">
								<mat-label [translate]="'odontologia.nueva-consulta.alergias.CRITICALITY'">
								</mat-label>
								<mat-select id="criticality_select" formControlName="criticality">
									<mat-option *ngFor="let criticalityType of criticalityTypes" [value]="criticalityType.id">
										{{criticalityType.display}}
									</mat-option>
								</mat-select>
								<mat-error translate="forms.REQUIRED"></mat-error>
							</mat-form-field>

							<div align="end">
								<button id="submit_allergies" class="uppercase" mat-raised-button color="primary"
										type="submit">
									<span class="uppercase"
										  [translate]="'odontologia.nueva-consulta.alergias.ADD'"></span>
								</button>
							</div>
						</form>
					</ng-template>
				</ng-container>

				<app-document-section-table data-display [tableTitle]="'odontologia.nueva-consulta.alergias.table.TITLE'"
								[columns]="allergiesNewConsultationService.getTableColumnConfig()"
								[data]="allergiesNewConsultationService.getAlergias()">
				</app-document-section-table>

			</app-new-document-section>
		</div>

		<div id="medications">

			<app-new-document-section sectionTitle="odontologia.nueva-consulta.medicaciones.TITLE">
				<div concept-form>
					<app-concepts-search
						*ngIf="!medicationsNewConsultationService.getSnomedConcept() else medicationForm"
						[label]="'odontologia.nueva-consulta.medicaciones.CONCEPT_LABEL'"
						(search)="medicationsNewConsultationService.openSearchDialog($event)">
					</app-concepts-search>
				</div>

				<ng-template #medicationForm>
					<form [formGroup]="medicationsNewConsultationService.getForm()"
						  (ngSubmit)="medicationsNewConsultationService.addToList()">
						<mat-form-field appearance="outline">
							<mat-label [translate]="'odontologia.nueva-consulta.medicaciones.NOMBRE_MEDICACION'">
							</mat-label>
							<input matInput type="text" formControlName="snomed" name="snomed" readonly
								   matTooltip="{{ medicationsNewConsultationService.getSnomedConcept().pt }}">
							<button id="clear_medication" mat-button matSuffix color="warn" mat-icon-button
									(click)="medicationsNewConsultationService.resetForm()">
								<mat-icon>close</mat-icon>
							</button>
						</mat-form-field>

						<mat-form-field appearance="outline">
							<mat-label
								[translate]="'odontologia.nueva-consulta.medicaciones.OBSERVACIONES'"></mat-label>
							<textarea matInput type="text" id="observations" name="observaciones"
									  formControlName="observaciones"
									  placeholder="{{'odontologia.nueva-consulta.medicaciones.DESCRIPCION' | translate }}"
							>
							</textarea>
							<mat-error *ngIf="hasError(medicationsNewConsultationService.getForm(), 'maxlength', 'observaciones')" translate="forms.MAX_LENGTH_ERROR"
									   [translateParams]="{max: TEXT_AREA_MAX_LENGTH}">
							</mat-error>
						</mat-form-field>

						<div class="margin-checkbox">
							<mat-checkbox formControlName="suspendido">
								<span [translate]="'odontologia.nueva-consulta.medicaciones.SUSPENDIDO'"></span>
							</mat-checkbox>
						</div>

						<div align="end">
							<button class="uppercase" mat-raised-button color="primary" type="submit">
								<span [translate]="'internaciones.anamnesis.medicacion.ADD'"></span>
							</button>
						</div>
					</form>
				</ng-template>

				<app-document-section-table data-display tableTitle="odontologia.nueva-consulta.medicaciones.TABLE_TITLE"
											[columns]="medicationsNewConsultationService.getTableColumnConfig()"
											[data]="medicationsNewConsultationService.getMedicaciones()">
				</app-document-section-table>

			</app-new-document-section>
		</div>

		<div id="evolution">
			<app-document-section [sectionTitle]="'odontologia.nueva-consulta.evolucion.TITLE'">
				<ng-container concept-form>
					<form [formGroup]="formEvolucion">
						<mat-form-field appearance="outline">
							<textarea matInput type="text" id="evolution_input" name="evolution" formControlName="evolution"
									  placeholder="{{'odontologia.nueva-consulta.evolucion.DESCRIPCION' | translate }}"
							>
							</textarea>
						</mat-form-field>
					</form>
				</ng-container>
			</app-document-section>
		</div>


	</div>

</app-dock-popup>
