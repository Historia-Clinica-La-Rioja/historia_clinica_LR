<div mat-dialog-title fxLayout="row" fxLayoutAlign="space-between">
	<div class="mat-h2" [translate]="'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.TITLE'"></div>
	<button mat-button (click)="dialogRef.close();" tabindex="-1">
		<mat-icon>close</mat-icon>
	</button>
</div>

<div mat-dialog-content>

	<mat-tab-group mat-align-tabs="center">
		<mat-tab
			label="{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.NEW_VACCINE_TAB' | translate }}">

			<form [formGroup]="billableForm" (submit)="submit()">
				<div fxLayout="column">
					<mat-label>
						{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.ADMINISTRATION_DATE' |
						translate }}
					</mat-label>
					<mat-form-field appearance="outline">
						<input readonly placeholder="mm/dd/yyyy" matInput [value]="this.today"
							[matDatepicker]="myDatepicker" formControlName="date" [max]="this.today" required>
						<mat-datepicker-toggle matSuffix [for]="myDatepicker"></mat-datepicker-toggle>
						<mat-datepicker #myDatepicker startView="multi-year" (yearSelected)="chosenYearHandler($event)"
							(monthSelected)="chosenMonthHandler($event)">
						</mat-datepicker>
						<mat-error [translate]="'forms.REQUIRED'"></mat-error>
					</mat-form-field>

					<ng-container *ngIf="snomedConcept else searchImmunizations">
						<mat-label>
							{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.INMUNIZATION' | translate
							}}
						</mat-label>
						<mat-form-field appearance="outline">
							<input matInput required readonly formControlName="snomed"
								matTooltip="{{ snomedConcept.pt }}">
							<button type="button" id="clear" mat-button matSuffix color="warn" mat-icon-button
								(click)="resetConcept()">
								<mat-icon>close</mat-icon>
							</button>
							<mat-error [translate]="'forms.REQUIRED'"></mat-error>
						</mat-form-field>
					</ng-container>

					<ng-template #searchImmunizations>
						<app-concepts-search
							[label]="'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.INMUNIZATION'"
							(search)="onSearch($event)">
						</app-concepts-search>
						<div class="spinner">
							<mat-spinner diameter="70" color="primary" *ngIf="searching"></mat-spinner>
						</div>
						<app-table *ngIf="!searching && !snomedConcept" [model]="conceptsResultsTable"></app-table>
					</ng-template>

					<mat-label>
						{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.CONDITION' | translate }}
					</mat-label>
					<mat-form-field appearance="outline">
						<mat-select formControlName="condition" (selectionChange)="loadSchemes($event.value)">
							<mat-option [value]="null"></mat-option>
							<mat-option *ngFor="let condition of conditions; index as i" [value]="i">
								{{ condition.description }}
							</mat-option>
						</mat-select>
						<mat-error [translate]="'forms.REQUIRED'"></mat-error>
					</mat-form-field>

					<div fxLayout="row" fxLayoutAlign="space-between">
						<div fxLayout="column" fxFlex="50%">
							<mat-label>
								{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.SCHEME' | translate }}
							</mat-label>
							<mat-form-field appearance="outline">
								<mat-select formControlName="scheme" [required]="this.billableForm.value.condition"
									(selectionChange)="loadDoses($event.value)">
									<mat-option *ngFor="let scheme of schemes; index as i" [value]="i">
										{{ scheme.description }}
									</mat-option>
								</mat-select>
								<mat-error [translate]="'forms.REQUIRED'"></mat-error>
							</mat-form-field>
						</div>
						<div fxLayout="column" fxFlex="50%">
							<mat-label>
								{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.DOSE' | translate }}
							</mat-label>
							<mat-form-field appearance="outline">
								<mat-select formControlName="dose" [required]="this.billableForm.value.scheme">
									<mat-option *ngFor="let dose of doses; index as i" [value]="i">
										{{ dose.description }}
									</mat-option>
								</mat-select>
								<mat-error [translate]="'forms.REQUIRED'"></mat-error>
							</mat-form-field>
						</div>
					</div>

					<mat-label>
						{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.LOT' | translate }}
					</mat-label>
					<mat-form-field appearance="outline">
						<input matInput formControlName="lot">
					</mat-form-field>

					<mat-label>
						{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.NOTE' | translate }}
					</mat-label>
					<mat-form-field appearance="outline">
						<textarea matInput formControlName="note" cdkAutosizeMinRows="5" cdkAutosizeMaxRows="5">
						</textarea>
					</mat-form-field>

					<div fxLayout="row" fxLayoutAlign="end">
						<button type="submit" mat-flat-button color="primary">
							{{ 'buttons.ADD' | translate | uppercase }}
						</button>
					</div>
				</div>
			</form>

		</mat-tab>

		<mat-tab
			label="{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.PREVIOUS_VACCINE_TAB' | translate }}">

			<form [formGroup]="previousForm" (submit)="submit()">
				<div fxLayout="column">
					<mat-label>
						{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.ADMINISTRATION_DATE' |
						translate }}
					</mat-label>
					<mat-form-field appearance="outline">
						<input placeholder="mm/dd/yyyy" matInput [value]="this.today"
							[matDatepicker]="previousDatepicker" formControlName="date" [max]="this.today" required>
						<mat-datepicker-toggle matSuffix [for]="previousDatepicker"></mat-datepicker-toggle>
						<mat-datepicker #previousDatepicker startView="multi-year"
							(yearSelected)="chosenYearHandler($event)" (monthSelected)="chosenMonthHandler($event)">
						</mat-datepicker>
						<mat-error [translate]="'forms.REQUIRED'"></mat-error>
					</mat-form-field>

					<mat-label>
						{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.INMUNIZATION' | translate }}
					</mat-label>
					<mat-form-field appearance="outline">
						<input matInput required formControlName="snomed">
						<mat-error [translate]="'forms.REQUIRED'"></mat-error>
					</mat-form-field>

					<mat-label>
						{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.CONDITION' | translate }}
					</mat-label>
					<mat-form-field appearance="outline">
						<mat-select required formControlName="condition">
							<mat-option *ngFor="let condition of conditions" [value]="condition">
								{{condition}}
							</mat-option>
						</mat-select>
						<mat-error [translate]="'forms.REQUIRED'"></mat-error>
					</mat-form-field>

					<div fxLayout="row" fxLayoutAlign="space-between">
						<div fxLayout="column" fxFlex="50%">
							<mat-label>
								{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.SCHEME' | translate }}
							</mat-label>
							<mat-form-field appearance="outline">
								<mat-select required formControlName="scheme">
									<mat-option *ngFor="let scheme of schemes" [value]="scheme">
										{{scheme}}
									</mat-option>
								</mat-select>
								<mat-error [translate]="'forms.REQUIRED'"></mat-error>
							</mat-form-field>
						</div>
						<div fxLayout="column" fxFlex="50%">
							<mat-label>
								{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.DOSE' | translate }}
							</mat-label>
							<mat-form-field appearance="outline">
								<mat-select required formControlName="dose">
									<mat-option *ngFor="let dose of doses" [value]="dose">
										{{dose}}
									</mat-option>
								</mat-select>
								<mat-error [translate]="'forms.REQUIRED'"></mat-error>
							</mat-form-field>
						</div>
					</div>

					<mat-label>
						{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.LOT' | translate }}
					</mat-label>
					<mat-form-field appearance="outline">
						<input matInput formControlName="lot">
					</mat-form-field>

					<mat-label>
						{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.INSTITUTION' | translate }}
					</mat-label>
					<mat-form-field appearance="outline">
						<input matInput formControlName="institution">
					</mat-form-field>

					<mat-label>
						{{ 'ambulatoria.paciente.vacunas2.agregar_vacunas.agregar_vacuna.PROFESSIONAL' | translate }}
					</mat-label>
					<mat-form-field appearance="outline">
						<input matInput formControlName="proffesional">
					</mat-form-field>

					<div fxLayout="row" fxLayoutAlign="end">
						<button type="submit" mat-flat-button color="primary">
							{{ 'buttons.ADD' | translate | uppercase }}
						</button>
					</div>
				</div>
			</form>

		</mat-tab>
	</mat-tab-group>

</div>