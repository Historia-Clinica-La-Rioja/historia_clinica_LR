<div>
	<button mat-button mat-icon-button [mat-dialog-close]=true>
		<mat-icon>close</mat-icon>
	</button>
</div>

<form [formGroup]="form" (ngSubmit)="save()">
	<h1 [translate]="'internaciones.internacion-paciente.documents.dialogs.attach.TITLE'"></h1>

    <app-typeahead
        *ngIf="documentTypes?.length > 0; else noDocumentsType"
        [options]="documentTypes"
        [titleInput]="'internaciones.internacion-paciente.documents.dialogs.attach.fields.TYPE' | translate"
        [required]="required"
        (selectionChange)="setDocumentType($event)">
    </app-typeahead>
    <mat-error class="typeahead-required" *ngIf="hasError(form, 'required', 'type') && documentTypes?.length > 0"
        [translate]="'internaciones.internacion-paciente.documents.dialogs.attach.fields.TYPE_REQUIRED'">
    </mat-error>
    <mat-error class="typeahead-required" *ngIf="hasError(form, 'invalid', 'type')">
        {{hasConsentDocumentError}}
    </mat-error>

	<section class="file-actions" *ngIf="(!file && !hasError(form, 'required', 'type'))">
		<div *ngIf="showGenerateDocument">
			<button mat-stroked-button color="primary" fxFlex="100%" (click)="generateDocument()" [disabled]="!isAdministrative">
				<mat-icon class="material-icons-outlined">add_circle_outline</mat-icon>
				<span
					[translate]="'internaciones.internacion-paciente.documents.dialogs.attach.actions.GENERATE_DOCUMENT'"></span>
			</button>
		</div>
		<div *ngIf="showAttachFile">
			<button mat-stroked-button color="primary" fxFlex="100%" (click)="fileInput.click()">
				<mat-icon>attachment</mat-icon>
				<span
					[translate]="'internaciones.internacion-paciente.documents.dialogs.attach.actions.ATTACH_FILE'"></span>
			</button>
			<input hidden (change)="onFileSelected($event)" #fileInput type="file" id="file"
				accept=".jpg, .jpeg, .png, .pdf" (click)="$event.target.value=null">
		</div>
	</section>

	<section class="surgical-info" *ngIf="showSurgicalInfo">
		<form [formGroup]="surgicalForm" (ngSubmit)="generate()">
			<app-typeahead *ngIf="professionals?.length > 0; else noProfessional" [options]="professionals"
				[titleInput]="'internaciones.internacion-paciente.documents.dialogs.attach.fields.PROFESSIONAL' | translate"
				[required]="required" (selectionChange)="setProfessional($event)">
			</app-typeahead>
			<mat-error class="typeahead-required"
				*ngIf="hasError(surgicalForm, 'required', 'professional') && professionals?.length > 0"
				[translate]="'internaciones.internacion-paciente.documents.dialogs.attach.fields.PROFESSIONAL_REQUIRED'">
			</mat-error>

				<ng-container class="procedures form-field">
					<app-concepts-search [label]="'historia-clinica.new-consultation-procedure-form.PROCEDURE'"
						(search)="procedureService.openSearchDialogAndAddConcept($event)">
					</app-concepts-search>
				</ng-container>
				<mat-error class="typeahead-required"
					*ngIf="hasError(surgicalForm, 'required', 'procedures') && procedureService.isEmpty()"
					[translate]="'internaciones.internacion-paciente.documents.dialogs.attach.fields.PROCEDURE_REQUIRED'">
				</mat-error>
				<app-titled-content-card *ngIf="!procedureService.isEmpty()"
					[title]="'internaciones.internacion-paciente.documents.dialogs.attach.fields.ADDED_PROCEDURES'">
					<app-procedure-list [service]="procedureService"></app-procedure-list>
				</app-titled-content-card>

			<mat-form-field appearance="outline" class="form-field">
				<textarea formControlName="observation"
					placeholder="{{'internaciones.internacion-paciente.documents.dialogs.attach.fields.OBSERVATIONS' | translate }}"
					matInput type="text" id="observation">
				</textarea>
			</mat-form-field>

			<div fxLayout="row" fxLayoutAlign="end" fxLayoutGap="15px">
				<button mat-stroked-button color="primary" btn-block type="button" (click)="hideSurgicalInfo()">
					<span> {{'internaciones.internacion-paciente.documents.dialogs.attach.actions.CANCEL' |
						translate}}</span>
				</button>
				<button mat-flat-button color="primary"
					[disabled]="professionals?.length > 0 && procedureService.isEmpty()">
					<span> {{'internaciones.internacion-paciente.documents.dialogs.attach.actions.GENERATE' |
						translate}}</span>
				</button>
			</div>
		</form>
	</section>

	<section class="file" *ngIf="file">
		<a (click)="openFile(file)">{{file.name}}</a>
		<button mat-button mat-icon-button color="warn" (click)="deleteFile()">
			<mat-icon>delete_outline</mat-icon>
		</button>
	</section>

	<section class="dialog-actions" *ngIf="!showSurgicalInfo">
		<button mat-stroked-button color="primary" [mat-dialog-close]=true>
			<span [translate]="'internaciones.internacion-paciente.documents.dialogs.attach.actions.CANCEL'"></span>
		</button>

		<button mat-raised-button color="primary" [disabled]=" ! this.form.valid">
			<span [translate]="'internaciones.internacion-paciente.documents.dialogs.attach.actions.CONTINUE'"></span>
		</button>
	</section>

	<ng-template #noDocumentsType>
		<p [translate]="'internaciones.internacion-paciente.documents.dialogs.attach.NO-DOCUMENTS-TYPE'">
		</p>
	</ng-template>
	<ng-template #noProfessional>
		<p [translate]="'internaciones.internacion-paciente.documents.dialogs.attach.NO-PROFESSIONAL'">
		</p>
	</ng-template>
</form>
