<section class="worklist-section">
    <mat-card class="main-card">
        <h2 class="page-title">{{'image-network.worklist.WORKLIST_BY_INFORMER' | translate }}</h2>
        <form [formGroup]="modalitiesForm" name="modalities-form">
            <mat-form-field class="dropdown-container" appearance="outline">
                <mat-label [translate]="'image-network.worklist.MODALITIES'"></mat-label>
                <mat-select id="modalities" (selectionChange)="selectModality($event)" fxFlex="98%"
                    formControlName="modalities">
                    <mat-option *ngFor="let modality of modalities$ | async" [value]="modality.id">
                        {{modality.description}}
                    </mat-option>
                </mat-select>
                <button *ngIf="modalitiesForm.value.modalities" mat-button matSuffix color="warn" mat-icon-button
                    (click)="cleanInput(); $event.stopPropagation()">
                    <mat-icon>close</mat-icon>
                </button>
            </mat-form-field>

            <mat-form-field appearance="outline" class="date-range">
                <mat-label [translate]="'image-network.worklist.DATE_RANGE'"></mat-label>
                <mat-date-range-input
                    [min]="dateRangeMin"
                    [max]="dateRangeMax"
                    [formGroup]="dateRangeForm"
                    [rangePicker]="picker">
                    <input matStartDate placeholder="{{ 'image-network.worklist.START_DATE' | translate }}" formControlName="start" (dateChange)="setWorkList()">
                    <input matEndDate placeholder="{{ 'image-network.worklist.END_DATE' | translate }}" formControlName="end" (dateChange)="setWorkList()">
                </mat-date-range-input>
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
        </form>
        <mat-card class="worklist-card">
            <mat-list class="mat-form-field-wrapper" *ngIf="worklists.length else noInfo">
                <div *ngFor="let worklist of pageSlice" fxLayout="column">
                    <mat-list-item class="appointment-detail">
                        <div data-id="study-card" fxFlex="100" fxLayout.lt-md="column" fxLayoutAlign="space-between center" style="gap: 10px;">
                            <app-worklist fxLayout="row" fxLayoutAlign="space-between end" fxFlex fxLayoutGap="10px" [worklist]="worklist">
                            </app-worklist>

                            <button id="complete_study" class="btn"
                                *ngIf="worklist.state.id == PENDING else studyCompleted" mat-flat-button color="primary"
                                mat-button (click)="goToDetails(worklist.appointmentId)">
                                {{ 'image-network.worklist.FINISH' | translate | uppercase }}
                            </button>
                            <ng-template #studyCompleted>
                                <button id="view_details" class="btn" *ngIf="worklist.state.id == COMPLETED"
                                    mat-stroked-button color="primary" mat-button
                                    (click)="goToDetails(worklist.appointmentId)">
                                    {{ 'image-network.worklist.VIEW_DETAILS' | translate | uppercase }}
                                </button>
                            </ng-template>
                        </div>
                    </mat-list-item>
                    <mat-divider></mat-divider>
                </div>
            </mat-list>
            <ng-template #noInfo>
                <app-no-data></app-no-data>
            </ng-template>
            <mat-paginator #paginator *ngIf="(worklists.length !== 0)" [length]="worklists.length"
                        [pageSizeOptions]="pageSizeOptions" (page)="onPageChange($event)">
            </mat-paginator>
        </mat-card>
    </mat-card>
</section>