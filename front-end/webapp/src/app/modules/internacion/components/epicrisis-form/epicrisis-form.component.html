<div class="container">
	<form id="epicrisis-form" (keydown.enter)="false" [formGroup]="form" (ngSubmit)="save()">
		<section id="title">
			<h2 class="page-title" [translate]="'internaciones.epicrisis.TITLE'"></h2>
			<h3 [translate]="'internaciones.epicrisis.SUBTITLE'"></h3>
		</section>

		<section id="mainDiagnosis">
			<h2 class="mat-h2" [translate]="'internaciones.epicrisis.diagnosticos.TITLE_PRINCIPAL'"></h2>
			<mat-card class="main-diagnosis">
				<mat-card-content>
					<mat-form-field appearance="outline">
						<input matInput
							   type="text"
							   formControlName="snomed"
							   name="snomed"
							   readonly
							   matTooltip="{{ this.form.value.snomed }}"
						>
					</mat-form-field>
				</mat-card-content>
			</mat-card>
		</section>

		<section id="diagnosticos">
			<h2 class="mat-h2" [translate]="'internaciones.epicrisis.diagnosticos.TITLE'"></h2>
			<table mat-table [dataSource]="diagnosis.data" class="secondary">

				<ng-container *ngFor="let column of diagnosis.columns" [matColumnDef]="column.def">
					<th *matHeaderCellDef>{{ column.header | translate }}</th>
					<td mat-cell *matCellDef="let element"> {{ column.display(element) }} </td>
				</ng-container>

				<tr mat-header-row *matHeaderRowDef="diagnosis.displayedColumns"></tr>
				<tr mat-row *matRowDef="let row; columns: diagnosis.displayedColumns;"></tr>

				<ng-container matColumnDef="select">
					<th mat-header-cell class="actions" *matHeaderCellDef>
						<mat-checkbox *ngIf="diagnosis.data.length !== 0"
									  (change)="$event ? masterToggle(diagnosis.data, diagnosis.selection) : null"
									  [checked]="diagnosis.selection.hasValue() && isAllSelected(diagnosis.data, diagnosis.selection)"
									  [indeterminate]="diagnosis.selection.hasValue() && !isAllSelected(diagnosis.data, diagnosis.selection)">
						</mat-checkbox>
					</th>
					<td mat-cell class="actions" *matCellDef="let row">
						<mat-checkbox (click)="$event.stopPropagation()"
									  (change)="$event ? diagnosis.selection.toggle(row) : null"
									  [checked]="diagnosis.selection.isSelected(row)">
						</mat-checkbox>
					</td>
				</ng-container>
			</table>
			<app-no-data class="secondary" *ngIf="diagnosis.data.length === 0"></app-no-data>

		</section>

		<section id="personalHistories">
			<h2 class="mat-h2" [translate]="'internaciones.epicrisis.antecedentes-personales.TITLE'"></h2>
			<table mat-table [dataSource]="personalHistories.data" class="secondary">

				<ng-container *ngFor="let column of personalHistories.columns" [matColumnDef]="column.def">
					<th *matHeaderCellDef>{{ column.header | translate }}</th>
					<td mat-cell *matCellDef="let element"> {{ column.display(element) }} </td>
				</ng-container>

				<tr mat-header-row *matHeaderRowDef="personalHistories.displayedColumns"></tr>
				<tr mat-row *matRowDef="let row; columns: personalHistories.displayedColumns;"></tr>

				<ng-container matColumnDef="select">
					<th mat-header-cell class="actions" *matHeaderCellDef>
						<mat-checkbox *ngIf="personalHistories.data.length !== 0"
									  (change)="$event ? masterToggle(personalHistories.data, personalHistories.selection) : null"
									  [checked]="personalHistories.selection.hasValue() && isAllSelected(personalHistories.data, personalHistories.selection)"
									  [indeterminate]="personalHistories.selection.hasValue() && !isAllSelected(personalHistories.data, personalHistories.selection)">
						</mat-checkbox>
					</th>
					<td mat-cell class="actions" *matCellDef="let row">
						<mat-checkbox (click)="$event.stopPropagation()"
									  (change)="$event ? personalHistories.selection.toggle(row) : null"
									  [checked]="personalHistories.selection.isSelected(row)">
						</mat-checkbox>
					</td>
				</ng-container>

			</table>
			<app-no-data class="secondary" *ngIf="personalHistories.data.length === 0"></app-no-data>

		</section>

		<section id="familyHistories">
			<h2 class="mat-h2" [translate]="'internaciones.epicrisis.antecedentes-familiares.TITLE'"></h2>
			<table mat-table [dataSource]="familyHistories.data" class="secondary">

				<ng-container *ngFor="let column of familyHistories.columns" [matColumnDef]="column.def">
					<th *matHeaderCellDef>{{ column.header | translate }}</th>
					<td mat-cell *matCellDef="let element"> {{ column.display(element) }} </td>
				</ng-container>

				<tr mat-header-row *matHeaderRowDef="familyHistories.displayedColumns"></tr>
				<tr mat-row *matRowDef="let row; columns: familyHistories.displayedColumns;"></tr>

				<ng-container matColumnDef="select">
					<th mat-header-cell class="actions" *matHeaderCellDef>
						<mat-checkbox *ngIf="familyHistories.data.length !== 0"
									  (change)="$event ? masterToggle(familyHistories.data, familyHistories.selection) : null"
									  [checked]="familyHistories.selection.hasValue() && isAllSelected(familyHistories.data, familyHistories.selection)"
									  [indeterminate]="familyHistories.selection.hasValue() && !isAllSelected(familyHistories.data, familyHistories.selection)">
						</mat-checkbox>
					</th>
					<td mat-cell class="actions" *matCellDef="let row">
						<mat-checkbox (click)="$event.stopPropagation()"
									  (change)="$event ? familyHistories.selection.toggle(row) : null"
									  [checked]="familyHistories.selection.isSelected(row)">
						</mat-checkbox>
					</td>
				</ng-container>

			</table>
			<app-no-data class="secondary" *ngIf="familyHistories.data.length === 0"></app-no-data>

		</section>

		<section id="allergies">
			<h2 class="mat-h2" [translate]="'internaciones.epicrisis.alergias.TITLE'"></h2>
			<table mat-table [dataSource]="allergies.data" class="secondary">

				<ng-container *ngFor="let column of allergies.columns" [matColumnDef]="column.def">
					<th *matHeaderCellDef>{{ column.header | translate }}</th>
					<td mat-cell *matCellDef="let element"> {{ column.display(element) }} </td>
				</ng-container>

				<tr mat-header-row *matHeaderRowDef="allergies.displayedColumns"></tr>
				<tr mat-row *matRowDef="let row; columns: allergies.displayedColumns;"></tr>

				<ng-container matColumnDef="select">
					<th mat-header-cell class="actions" *matHeaderCellDef>
						<mat-checkbox *ngIf="allergies.data.length !== 0"
									  (change)="$event ? masterToggle(allergies.data, allergies.selection) : null"
									  [checked]="allergies.selection.hasValue() && isAllSelected(allergies.data, allergies.selection)"
									  [indeterminate]="allergies.selection.hasValue() && !isAllSelected(allergies.data, allergies.selection)">
						</mat-checkbox>
					</th>
					<td mat-cell class="actions" *matCellDef="let row">
						<mat-checkbox (click)="$event.stopPropagation()"
									  (change)="$event ? allergies.selection.toggle(row) : null"
									  [checked]="allergies.selection.isSelected(row)">
						</mat-checkbox>
					</td>
				</ng-container>

			</table>
			<app-no-data class="secondary" *ngIf="allergies.data.length === 0"></app-no-data>

		</section>

		<section id="medication">
			<app-medicacion [(medications)]="medications"
							[hideSuspended]="true"
							[title]="'internaciones.epicrisis.medicacion.TITLE'">
			</app-medicacion>
		</section>

		<section id="inmunizations">
			<h2 class="mat-h2" [translate]="'internaciones.epicrisis.vacunas.TITLE'"></h2>
			<table mat-table [dataSource]="inmunizations.data" class="secondary">

				<ng-container *ngFor="let column of inmunizations.columns" [matColumnDef]="column.def">
					<th *matHeaderCellDef>{{ column.header | translate }}</th>
					<td mat-cell *matCellDef="let element"> {{ column.display(element) }} </td>
				</ng-container>

				<tr mat-header-row *matHeaderRowDef="inmunizations.displayedColumns"></tr>
				<tr mat-row *matRowDef="let row; columns: inmunizations.displayedColumns;"></tr>

				<ng-container matColumnDef="select">
					<th mat-header-cell class="actions" *matHeaderCellDef>
						<mat-checkbox *ngIf="inmunizations.data.length !== 0"
									  (change)="$event ? masterToggle(inmunizations.data, inmunizations.selection) : null"
									  [checked]="inmunizations.selection.hasValue() && isAllSelected(inmunizations.data, inmunizations.selection)"
									  [indeterminate]="inmunizations.selection.hasValue() && !isAllSelected(inmunizations.data, inmunizations.selection)">
						</mat-checkbox>
					</th>
					<td mat-cell class="actions" *matCellDef="let row">
						<mat-checkbox (click)="$event.stopPropagation()"
									  (change)="$event ? inmunizations.selection.toggle(row) : null"
									  [checked]="inmunizations.selection.isSelected(row)">
						</mat-checkbox>
					</td>
				</ng-container>

			</table>
			<app-no-data class="secondary" *ngIf="inmunizations.data.length === 0"></app-no-data>

		</section>

		<section id="observations">
			<h2 [translate]="'internaciones.epicrisis.observations.TITLE'"></h2>
			<mat-card>
				<mat-card-content formGroupName="observations">
					<div>
						<mat-label [translate]="'internaciones.epicrisis.observations.EVOLUTION_NOTE'"></mat-label>
						<mat-form-field [floatLabel]="'never'" appearance="outline">
							<textarea matInput type="text" id="evolutionNote" name="evolutionNote"
									  formControlName="evolutionNote">
							</textarea>
							<mat-error [translate]="'forms.REQUIRED'">
							</mat-error>
						</mat-form-field>
					</div>
					<div>
						<mat-label [translate]="'internaciones.epicrisis.observations.STUDIES_SUMMARY'"></mat-label>
						<mat-form-field [floatLabel]="'never'" appearance="outline">
							<textarea matInput type="text" id="studiesSummaryNote" name="studiesSummaryNote"
									  formControlName="studiesSummaryNote">
							</textarea>
							<mat-error [translate]="'forms.REQUIRED'">
							</mat-error>
						</mat-form-field>
					</div>
					<div>
						<mat-label [translate]="'internaciones.epicrisis.observations.PHYSICAL_EXAMINATION'">
						</mat-label>
						<mat-form-field [floatLabel]="'never'" appearance="outline">
							<textarea matInput type="text" id="physicalExamNote" name="physicalExamNote"
									  formControlName="physicalExamNote">
							</textarea>
							<mat-error [translate]="'forms.REQUIRED'">
							</mat-error>
						</mat-form-field>
					</div>
					<div>
						<mat-label [translate]="'internaciones.epicrisis.observations.INDICATIONS_NOTE'"></mat-label>
						<mat-form-field [floatLabel]="'never'" appearance="outline">
							<textarea matInput type="text" id="indicationsNote" name="indicationsNote"
									  formControlName="indicationsNote">
							</textarea>
							<mat-error [translate]="'forms.REQUIRED'">
							</mat-error>
						</mat-form-field>
					</div>
					<div>
						<mat-label [translate]="'internaciones.epicrisis.observations.OTHERS'"></mat-label>
						<mat-form-field [floatLabel]="'never'" appearance="outline">
							<textarea matInput type="text" id="otherNote" name="otherNote" formControlName="otherNote">
							</textarea>
						</mat-form-field>
					</div>

				</mat-card-content>
			</mat-card>
		</section>

		<section id="buttons" class="form-buttons">
			<button mat-stroked-button type="button" color="primary" (click)="back()">
				<span class="uppercase"
					  [translate]="'buttons.BACK'">
				</span>
			</button>
			<button id="sign-confirm" mat-raised-button type="submit" color="primary" *hasRole="['ESPECIALISTA_MEDICO']">
				<span class="uppercase" [translate]="'internaciones.epicrisis.buttons.CONFIRM'"></span>
			</button>
		</section>
	</form>
</div>
