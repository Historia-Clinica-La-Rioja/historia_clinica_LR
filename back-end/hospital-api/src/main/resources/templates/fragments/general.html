<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head th:fragment="headerfiles">
    <title>Report</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- Bootstrap core CSS -->
    <th:block th:include="fragments/bootstrap-css.html :: style-inline"></th:block>
    <style>
		h3 {
			padding-top:10px
		}
        row {
            padding-left: 50px
        }
        .wide_wrapped_text {
            max-width: 70%;
            word-wrap: break-word;
            text-align: justify;
            text-justify: inter-word;
            white-space: pre-wrap;
        }

        .note {
            font-family: inherit;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /*HEADER*/

        .header {
            position: fixed;
            top: 0;
            width: 100%;
        }

        .header-space {
            height: 200px;
        }

        /*FOOTER*/
        @import url('https://fonts.googleapis.com/css2?family=Roboto&#38;display=swap');

        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        @page {
            @bottom-right {
                content: "Página " counter(page) " de " counter(pages);
                font-weight: 400;
                font-family: 'Roboto', sans-serif;
                font-size: 9.5px;
                padding-bottom: 20px;
            }
        }

        .line {
            border: 0;
            height: 1px;
            background: #333;
            background-image: linear-gradient(to right, #ccc, #333, #ccc);
        }

        .footer-space {
            height: 80px;
        }

        table {
            width: 100%;
            -fs-table-paginate: paginate;
        }

        /*TEXT FORMAT*/
        .data-text {
            font-weight: 400;
            font-family: 'Roboto', sans-serif;
            font-size: 13.21px;
        }

        .data-title {
            font-weight: 400;
            font-family: 'Roboto', sans-serif;
            font-size: 10.57px;
        }

        .institution-data {
            font-weight: 500;
            font-family: 'Roboto', sans-serif;
            font-size: 10px;
            padding-top: 8px;
        }

        .document-title {
            font-weight: 700;
            font-family: 'Roboto', sans-serif;
            font-size: 20px;
            text-transform: uppercase;
            padding-top: 15px;
            padding-bottom: 15px;
        }

        .section-title {
            font-weight: 500;
            font-family: 'Roboto', sans-serif;
            font-size: 14.35px;
        }

        .section-data {
            font-weight: 400;
            font-family: 'Roboto', sans-serif;
            font-size: 12.56px;
        }

        .row-content {
            float: left;
            margin-right: 30px;
        }

        .graph-container {
            width: 700px;
            height: 420px;
            padding-top: 10px;
        }

        .divider {
            background: rgb(180, 180, 180);
            border: 0;
            height: 1px;
            margin: 8px 0;
        }
	</style>
</head>
<body>

    <div th:fragment="header">
        <div class="header">
            <div style="padding-bottom: 20px;">
                <img style="width: 250px; height: 72px;" th:src="${'data:image/jpeg;charset=utf-8;base64,' + institutionLogo}" alt=""></img>
                <div style="float: right; width: 63%;">
                    <div class="institution-data" th:text="${institution.address}"></div>
                    <div class="institution-data" th:text="${'Tel: ' + institution.phone}"></div>
                    <div class="institution-data" th:text="${institution.email}"></div>
                </div>
            </div>
            <div>
                <div class="section-title">Información general</div>
                <div>
                    <div class="row-content">
                        <div class="data-title">Nombre y apellido del paciente</div>
                        <div style="float: left; margin-right: 3px;">
                            <div class="data-text" th:if="${patientCompleteName != null}" style="text-transform: uppercase;" th:text="${patientCompleteName}"></div>
                            <div class="data-text" th:if="${patientCompleteName == null}">Sin información</div>
                        </div>
                    </div>
                    <div class="row-content">
                        <div class="data-title">Documento</div>
                        <div class="data-text" th:if="${patient.identificationNumber != null}" th:text="${patient.identificationType + ' ' + patient.identificationNumber}"></div>
                        <div class="data-text" th:if="${patient.identificationNumber == null}">Sin información</div>
                    </div>
                    <div class="row-content">
                        <div class="data-title">N° HC</div>
                        <div class="data-text" th:text="${patient.id}"></div>
                    </div>
                    <div class="row-content">
                        <div class="data-title">ID Encuentro</div>
                        <div class="data-text" th:text="${encounterId}"></div>
                    </div>
                </div>
                <div>
                    <div style="clear: both;">
                        <div class="row-content">
                            <div class="data-title">Edad</div>
                            <div class="data-text" th:text="${patient.person.age}"></div>
                        </div>
                        <div class="row-content">
                            <div class="data-title">Fecha Nac.</div>
                            <div class="data-text" th:text="${#temporals.format(patient.person.birthDate, 'dd/MM/yyyy')}"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="clear: both;">
                <hr class="line"></hr>
            </div>
        </div>
    </div>

    <!-- Datos encuentro -->
    <div th:fragment="encounterData(type)">
        <div>
            <div>
                <div class="section-title">Episodio/Encuentro</div>
                <div style="margin-bottom: 10px;">
                    <div class="row-content">
                        <div class="data-title">Institucion</div>
                        <div class="data-text" th:text="${institution.name}"></div>
                    </div>
                    <div class="row-content">
                        <div class="data-title">Sector/Servicio</div>
                        <div class="data-text" th:if="${sector}" th:text="${sector}"></div>
                        <div class="data-text" th:unless="${sector}">Sin información</div>
                    </div>
                    <div class="row-content" th:if="${doctorsOffice != null}">
                        <div class="data-title">Consultorio</div>
                        <div class="data-text" th:text="${doctorsOffice}"></div>
                    </div>
                    <div class="row-content" th:if="${room != null}">
                        <div class="data-title">Habitación</div>
                        <div class="data-text" th:text="${room}"></div>
                    </div>
                    <div class="row-content" th:if="${shockRoom != null}">
                        <div class="data-title">Shockroom</div>
                        <div class="data-text" th:text="${shockRoom}"></div>
                    </div>
                    <div class="row-content">
                        <div class="data-title">Tipo</div>
                        <div class="data-text" th:text="${type}"></div>
                    </div>
                    <div class="row-content">
                        <div class="data-title">Fecha y Hora</div>
                        <div class="data-text" th:text="${#temporals.format(performedDate, 'dd/MM/yyyy | HH:mm') + ' hs'}"></div>
                    </div>
                </div>
                <div style="clear: both; margin-bottom: 10px;">
                    <div style="overflow-wrap: break-word; width: 40%" class="row-content">
                        <div class="data-title">Cobertura</div>
                        <div class="data-text" th:if="${patientCoverage != null}" th:text="${patientCoverage.medicalCoverage.name}"></div>
                        <div class="data-text" th:unless="${patientCoverage != null}">Sin información</div>
                    </div>
                    <div class="row-content">
                        <div class="data-title">N° de credencial</div>
                        <div class="data-text" th:if="${patientCoverage != null && patientCoverage.affiliateNumber != null}" th:text="${patientCoverage.affiliateNumber}"></div>
                        <div class="data-text" th:unless="${patientCoverage != null && patientCoverage.affiliateNumber != null}">Sin información</div>
                    </div>
                    <div class="row-content">
                        <div class="data-title">Plan</div>
                        <div class="data-text" th:if="${patientCoverage != null && patientCoverage.planName != null}" th:text="${patientCoverage.planName}"></div>
                        <div class="data-text" th:unless="${patientCoverage != null && patientCoverage.planName != null}">Sin información</div>
                    </div>
                </div>
            </div>
            <div style="clear: both;">
                <hr class="line"></hr>
            </div>
        </div>
    </div>

    <!-- Profesional -->
    <div th:fragment="professionalData">
        <div>
            <div class="section-title">Profesional originante</div>
            <div>
                <div class="row-content">
                    <div class="data-title">Nombre y apellido</div>
                    <div class="data-text" style="text-transform: uppercase;" th:if="${nameSelfDeterminationFF}" th:text="${author.nameSelfDetermination + ' ' + author.lastName}"></div>
                    <div class="data-text" style="text-transform: uppercase;" th:unless="${nameSelfDeterminationFF}" th:text="${author.firstName + ' ' + author.lastName}"></div>
                </div>
                <div class="row-content">
                    <div class="data-title">Profesión</div>
                    <div class="data-text" th:if="${author.professions != null}" th:text="${author.getProfessionsAsString()}"></div>
                </div>
                <div class="row-content">
                    <div class="data-title">Matricula</div>
                    <div class="data-text" th:text="${author.completeLicenseInfo}"></div>
                </div>
            </div>
            <div style="clear: both;">
                <hr class="line"></hr>
            </div>
        </div>
    </div>

    <!-- Profesionales intervinientes -->
    <div th:fragment="involvedProfessionalsData">
        <div th:if="${involvedProfessionals != null && !involvedProfessionals.isEmpty()}">
            <div>
                <div class="section-title">Profesionales responsables</div>
                <div th:each="involvedProfessional, iter: ${involvedProfessionals}">
                    <div class="row-content">
                        <div class="data-title">Nombre y apellido</div>
                        <div class="data-text" style="text-transform: uppercase;" th:if="${nameSelfDeterminationFF}" th:text="${involvedProfessional.nameSelfDetermination + ' ' + involvedProfessional.lastName}"></div>
                        <div class="data-text" style="text-transform: uppercase;" th:unless="${nameSelfDeterminationFF}" th:text="${involvedProfessional.firstName + ' ' + involvedProfessional.lastName}"></div>
                    </div>
                    <div class="row-content">
                        <div class="data-title">Profesión</div>
                        <div class="data-text" th:if="${involvedProfessional.professions != null && !involvedProfessional.professions.isEmpty()}" th:text="${involvedProfessional.getProfessionsAsString()}"></div>
                    </div>
                    <div class="row-content">
                        <div class="data-title">Matricula</div>
                        <div class="data-text" th:text="${involvedProfessional.completeLicenseInfo.isEmpty() ? '-' : involvedProfessional.completeLicenseInfo}"></div>
                    </div>
                </div>
            </div>
            <div style="clear: both;">
                <hr class="line"></hr>
            </div>
        </div>
    </div>

    <!-- Tipo Documento -->
    <div th:fragment="documentTypeTitle(title)">
        <div class="document-title" th:text="${title}"></div>
    </div>

    <!-- Datos personales -->

    <div th:fragment="personalData (patientType)">
        <h3 th:text="${patientType}"></h3>
        <div th:if="${patient.person != null}">
            <strong>- ID: </strong><label  th:text="${patient.id}"></label><br/>
            <div th:if="${patient.person.id != null}">
                <strong>- Nombre: </strong><label th:if="${!selfPerceivedFF || patient.person.nameSelfDetermination == null || patient.person.nameSelfDetermination == '' }" th:text="${patient.person.firstName + (patient.person.middleNames != null ? ' ' + patient.person.middleNames : '') }"></label><label th:if="${selfPerceivedFF && patient.person.nameSelfDetermination != null && patient.person.nameSelfDetermination != ''}" th:text="${patient.person.nameSelfDetermination}"></label><br/>
                <strong>- Apellido: </strong><label th:text="${patient.person.lastName + (patient.person.otherLastNames != null ? ' ' + patient.person.otherLastNames : '') }"></label><br/>
                <strong>- Edad: </strong><label th:text="${patientAge}"></label><br/>
                <strong>- Sexo: </strong><label th:if="${!selfPerceivedFF || patient.person.selfPerceivedGender == null || patient.person.selfPerceivedGender == '' }" th:text="${patient.person.gender.description}"></label><label th:if="${selfPerceivedFF && patient.person.selfPerceivedGender != null && patient.person.selfPerceivedGender != '' }" th:text="${patient.person.selfPerceivedGender}"></label><br/>
            </div>
        </div>
    </div>

    <!-- Especialidad clínica -->
    <div th:fragment="clinicalSpecialty (message)" th:if="${clinicalSpecialty != null}">
        <p class="section-title" th:text="${message}"></p>
        <div>
            <dl class="section-data">
                <dd><p th:text="${'- ' + clinicalSpecialty.name}"></p></dd>
            </dl>
        </div>
    </div>

    <!-- Diagnóstico principal -->
    <div th:fragment="mainDiagnosis (message)" th:if="${mainDiagnosis != null}">
        <p class="section-title" th:text="${message}"></p>
        <div>
            <dl class="section-data">
                <dd><p th:text="${'- ' + mainDiagnosis.snomed.pt}"></p></dd>
                <dl>
                    <dd><strong>Estado: </strong><label  th:text="${mainDiagnosis.status}"></label></dd>
                    <dd><strong>Verificación: </strong><label  th:text="${mainDiagnosis.verification}"></label></dd>
                </dl>
            </dl>
        </div>
    </div>

    <!-- Otros Diagnósticos/enfermedades -->
    <div th:fragment="diagnosis (message)" th:if="${not #lists.isEmpty(diagnosis)}">
        <p class="section-title" th:text="${message}"></p>
        <div>
            <dl class="section-data" th:each="diagnose,iter: ${diagnosis}">
                <dd><p th:text="${'- ' + diagnose.snomed.pt}"></p></dd>
                <dl>
                    <dd><strong>Estado: </strong><label  th:text="${diagnose.status}"></label></dd>
                    <dd><strong>Verificación: </strong><label  th:text="${diagnose.verification}"></label></dd>
                </dl>
            </dl>
        </div>
    </div>

    <!-- Diagnósticos pre-quirurgicos -->
    <div th:fragment="preoperativeDiagnosis (message)">
        <h3 th:text="${message}"></h3>
        <div th:if="${#lists.isEmpty(preoperativeDiagnosis)}">
            <dl class="lista" >
                <dd><p >Sin cambios registrados</p></dd>
            </dl>
        </div>
        <div th:if="${not #lists.isEmpty(preoperativeDiagnosis)}">
            <dl th:each="diagnose,iter: ${preoperativeDiagnosis}">
                <dd><p  th:text="${'- ' + diagnose.snomed.pt}"></p></dd>
                <dl>
                    <dd><strong>Estado: </strong><label  th:text="${diagnose.status}"></label></dd>
                    <dd><strong>Verificación: </strong><label  th:text="${diagnose.verification}"></label></dd>
                </dl>
            </dl>
        </div>
    </div>

    <!-- Diagnósticos post-quirurgicos -->
    <div th:fragment="postoperativeDiagnosis (message)">
        <h3 th:text="${message}"></h3>
        <div th:if="${#lists.isEmpty(postoperativeDiagnosis)}">
            <dl class="lista" >
                <dd><p >Sin cambios registrados</p></dd>
            </dl>
        </div>
        <div th:if="${not #lists.isEmpty(postoperativeDiagnosis)}">
            <dl th:each="diagnose,iter: ${postoperativeDiagnosis}">
                <dd><p  th:text="${'- ' + diagnose.snomed.pt}"></p></dd>
                <dl>
                    <dd><strong>Estado: </strong><label  th:text="${diagnose.status}"></label></dd>
                    <dd><strong>Verificación: </strong><label  th:text="${diagnose.verification}"></label></dd>
                </dl>
            </dl>
        </div>
    </div>

    <!-- Motivos -->
    <div th:fragment="reasons (message)" th:if="${not #lists.isEmpty(reasons)}">
        <p class="section-title" th:text="${message}"></p>
        <div>
            <dl class="section-data" th:each="reason,iter: ${reasons}">
                <dd><p th:text="${'- ' + reason.snomed.pt}"></p></dd>
            </dl>
        </div>
    </div>


    <!-- Procedimientos -->
    <div th:fragment="procedures (message)" th:if="${not #lists.isEmpty(procedures)}">
        <p class="section-title" th:text="${message}"></p>
        <div>
            <dl class="section-data" th:each="procedure,iter: ${procedures}">
                <dd><p th:text="${'- ' + procedure.snomed.pt}"></p></dd>
                <dl>
                    <dd><strong>Estado: </strong><label  th:text="${procedure.status}"></label></dd>
                    <dd th:if="${procedure.performedDate  != null}"><strong>Fecha de realización: </strong><label th:text="${#temporals.format(procedure.performedDate, 'dd/MM/yyyy')}"></label></dd>
                </dl>
            </dl>
        </div>
    </div>

    <!-- Cirugía propuesta -->
    <div th:fragment="surgeryProcedures(message)" th:if="${surgeryProcedures != null && not #lists.isEmpty(surgeryProcedures)}">
        <p class="section-title" th:text="${message}"></p>
        <div>
            <dl class="section-data" th:each="procedure,iter: ${surgeryProcedures}">
                <dd><p class="wide_wrapped_text" th:text="${'- ' + procedure.snomed.pt}"></p></dd>
            </dl>
        </div>
    </div>

    <!-- Anestesias -->
    <div th:fragment="anesthesia (message)">
        <h3 th:text="${message}"></h3>
        <div th:if="${#lists.isEmpty(anesthesia)}">
            <dl class="lista" >
                <dd><p >Sin cambios registrados</p></dd>
            </dl>
        </div>
        <div th:if="${not #lists.isEmpty(anesthesia)}">
            <dl th:each="procedure,iter: ${anesthesia}">
                <dd><p  th:text="${'- ' + procedure.snomed.pt}"></p></dd>
            </dl>
        </div>
    </div>

    <!-- Cultivo -->
    <div th:fragment="culture (message)">
        <h3 th:text="${message}"></h3>
        <div th:if="${culture == null}">
            <dl class="lista" >
                <dd><p >Sin cambios registrados</p></dd>
            </dl>
        </div>
        <div th:if="${culture != null}">
                <dd><p  th:text="${'- ' + culture.snomed.pt}"></p></dd>
            <dl>
                <dd><strong>Descripción: </strong><label  th:text="${culture.note}"></label></dd>
            </dl>
                <dl>
                    <dd><strong>Estado: </strong><label  th:text="${culture.status}"></label></dd>
                </dl>
        </div>
    </div>

    <!-- Biopsia por congelacion -->
    <div th:fragment="frozenSectionBiopsy (message)">
        <h3 th:text="${message}"></h3>
        <div th:if="${frozenSectionBiopsy == null}">
            <dl class="lista" >
                <dd><p >Sin cambios registrados</p></dd>
            </dl>
        </div>
        <div th:if="${frozenSectionBiopsy != null}">
            <dd><p  th:text="${'- ' + frozenSectionBiopsy.snomed.pt}"></p></dd>
            <dl>
                <dd><strong>Descripción: </strong><label  th:text="${frozenSectionBiopsy.note}"></label></dd>
            </dl>
            <dl>
                <dd><strong>Estado: </strong><label  th:text="${frozenSectionBiopsy.status}"></label></dd>
            </dl>
        </div>
    </div>

    <!-- Drenaje -->
    <div th:fragment="drainage (message)">
        <h3 th:text="${message}"></h3>
        <div th:if="${drainage == null}">
            <dl class="lista" >
                <dd><p >Sin cambios registrados</p></dd>
            </dl>
        </div>
        <div th:if="${drainage != null}">
            <dd><p  th:text="${'- ' + drainage.snomed.pt}"></p></dd>
            <dl>
                <dd><strong>Descripción: </strong><label  th:text="${drainage.note}"></label></dd>
            </dl>
            <dl>
                <dd><strong>Estado: </strong><label  th:text="${drainage.status}"></label></dd>
            </dl>
        </div>
    </div>

    <!-- Protesis -->
    <div th:fragment="prosthesis (message)">
        <h3 th:text="${message}"></h3>
        <div th:if="${prosthesis == null}">
            <dl class="lista" >
                <dd><p >Sin cambios registrados</p></dd>
            </dl>
        </div>
        <div th:if="${prosthesis != null}">
            <dl>
                <dd><strong>Descripción: </strong><label  th:text="${prosthesis}"></label></dd>
            </dl>
        </div>
    </div>

    <!-- Equipo quirófano -->
    <div th:fragment="healthcareProfessionals (message)">
        <h3 th:text="${message}"></h3>
        <div th:if="${#lists.isEmpty(healthcareProfessionals)}">
            <dl class="lista" >
                <dd><p >Sin cambios registrados</p></dd>
            </dl>
        </div>
        <div th:if="${not #lists.isEmpty(healthcareProfessionals)}">
            <dl th:each="professional,iter: ${healthcareProfessionals}">
                <dl>
                    <dd><strong>Rol: </strong><label  th:text="${professional.professionType.getDescription() + ( professional.otherProfessionTypeDescription != null ? ( ' - ' + professional.otherProfessionTypeDescription ) : '' )}"></label></dd>
                </dl>
                <dd><strong>Profesional: </strong> <p  th:text="${professional.healthcareProfessional.person.fullName}"></p></dd>
                <div th:if="${professional.comments != null}">
                    <dl>
                        <dd><strong>Comentarios: </strong><label  th:text="${professional.comments}"></label></dd>
                    </dl>
                </div>
            </dl>
        </div>
    </div>


    <!-- Descripcion cirugia realizada -->
    <div th:fragment="surgicalDescription (message)">
        <h3 th:text="${message}"></h3>
        <div th:if="${description == null}">
            <dl class="lista" >
                <dd><p >Sin comentarios</p></dd>
            </dl>
        </div>
        <div th:if="${description != null}">
            <dd><p  th:text="${description}"></p></dd>
        </div>
    </div>

    <!-- Problems -->
    <div th:fragment="problems (message)" th:if="${not #lists.isEmpty(problems)}">
        <p class="section-title" th:text="${message}"></p>
        <div>
            <dl th:each="problem,iter: ${problems}">
                <dd><p class="section-data" th:text="${'- ' + problem.snomed.pt}"></p></dd>
                <dl class="section-data">
                    <dd><strong>Estado: </strong><label  th:text="${problem.status}"></label></dd>
                    <dd><strong>Verificación: </strong><label  th:text="${problem.verification}"></label></dd>
                    <dd><strong>Fecha de inicio: </strong><label th:text="${#temporals.format(problem.startDate, 'dd/MM/yyyy')}"></label></dd>
                    <dd th:if="${problem.errorReason != null}" ><strong>Motivo: </strong><label th:text="${problem.errorReason}"></label></dd>
                    <dd th:if="${problem.errorReason != null}" ><strong>Observaciones: </strong><label class="note" th:text="${problem.errorObservations}"></label></dd>
                    <dd th:if="${problem.endDate  != null}"><strong>Fecha de fin: </strong><label th:text="${#temporals.format(problem.endDate, 'dd/MM/yyyy')}"></label></dd>
                </dl>
            </dl>
        </div>
    </div>

    <!-- Factor sanguíneo -->
    <div th:fragment="bloodType">
        <strong>- Factor sanguíneo:</strong>
            <span th:if="${anthropometricData.bloodType != null && #strings.equals(anthropometricData.bloodType.value, 'A+')}">A+</span>
            <span th:if="${anthropometricData.bloodType != null && #strings.equals(anthropometricData.bloodType.value, 'A−')}">A-</span>
            <span th:if="${anthropometricData.bloodType != null && #strings.equals(anthropometricData.bloodType.value, 'B+')}">B+</span>
            <span th:if="${anthropometricData.bloodType != null && #strings.equals(anthropometricData.bloodType.value, 'B−')}">B-</span>
            <span th:if="${anthropometricData.bloodType != null && #strings.equals(anthropometricData.bloodType.value, 'AB+')}">AB+</span>
            <span th:if="${anthropometricData.bloodType != null && #strings.equals(anthropometricData.bloodType.value, 'AB−')}">AB-</span>
            <span th:if="${anthropometricData.bloodType != null && #strings.equals(anthropometricData.bloodType.value, '0+')}">0+</span>
            <span th:if="${anthropometricData.bloodType != null && #strings.equals(anthropometricData.bloodType.value, '0−')}">0-</span>
            <span th:text="${anthropometricData.bloodType == null} ? 'Sin cambios registrados' : _"></span>
    </div>

    <!-- Altura -->
    <div th:fragment="height">
        <strong>- Talla:</strong>
        <span th:text="${anthropometricData.height != null} ? ${anthropometricData.height.value + 'cm'} : 'Sin cambios registrados'"></span>
    </div>

    <!-- Peso -->
    <div th:fragment="weight">
        <strong>- Peso:</strong>
        <span th:text="${anthropometricData.weight != null} ? ${anthropometricData.weight.value + 'Kg'} : 'Sin cambios registrados'"></span>
    </div>

    <!-- IMC -->
    <div th:fragment="icm">
        <strong>- IMC:</strong>
        <span th:text="${anthropometricData.BMI != null} ? ${anthropometricData.BMI.value} : 'Sin cambios registrados'"></span>
    </div>

    <!-- Perímetro encefálico -->
    <div th:fragment="headCircumference">
        <strong>- Perímetro cefálico:</strong>
        <span th:text="${anthropometricData.headCircumference != null} ? ${anthropometricData.headCircumference.value + 'cm'} : 'Sin cambios registrados'"></span>
    </div>

    <!-- Datos Antropométricos -->
    <div th:fragment="antropometicData(message)" th:if="${anthropometricData != null && anthropometricData.hasValues}">
        <p class="section-title" th:text="${message}"></p>
        <div class="section-data">
            <div th:replace=" :: bloodType"></div>
            <div th:replace=" :: height"></div>
            <div th:replace=" :: weight"></div>
            <div th:replace=" :: icm"></div>
            <div th:replace=" :: headCircumference"></div>
        </div>
    </div>

    <!-- Diagnósticos dentales -->

    <div th:fragment="dentalDiagnostics" th:if="${not #lists.isEmpty(dentalDiagnostics)}">
        <p class="section-title">Diagnósticos dentales</p>
        <div>
            <dl class="section-data" th:each="diagnostic,iter: ${dentalDiagnostics}">
                <dd><p th:text="${'- ' + diagnostic.snomed.pt}"></p></dd>
                <dl>
                    <dd><strong>Pieza: </strong><label  th:text="${diagnostic.tooth.pt}"></label></dd>
                    <dd th:if="${diagnostic.surface  != null}"><strong>Cara: </strong><label  th:text="${diagnostic.surface.pt}"></label></dd>
                </dl>
            </dl>
        </div>
    </div>

    <!-- Procedimientos dentales -->

    <div th:fragment="dentalProcedures" th:if="${not #lists.isEmpty(dentalProcedures)}">
        <p class="section-title">Procedimientos dentales</p>
        <div>
            <dl class="section-data" th:each="procedure,iter: ${dentalProcedures}">
                <dd><p th:text="${'- ' + procedure.snomed.pt}"></p></dd>
                <dl>
                    <dd><strong>Pieza: </strong><label  th:text="${procedure.tooth.pt}"></label></dd>
                    <dd th:if="${procedure.surface  != null}"><strong>Cara: </strong><label  th:text="${procedure.surface.pt}"></label></dd>
                </dl>
            </dl>
        </div>
    </div>

    <!-- Antecedentes personales -->

    <div th:fragment="personalHistory" th:if="${not #lists.isEmpty(personalHistories.content) || personalHistories.isReferred != null}">
        <p class="section-title">Antecedentes personales</p>
        <div th:if="${personalHistories.isReferred != null && personalHistories.isReferred == false}">
            <p class="section-data">No refiere</p>
        </div>
        <div th:if="${(personalHistories.isReferred == null && not #lists.isEmpty(personalHistories.content)) || personalHistories.isReferred == true}">
            <dl class="section-data" th:each="personalHistory,iter: ${personalHistories.content}">
                <dd><p th:text="${'- ' + personalHistory.snomed.pt}"></p></dd>
            </dl>
        </div>
    </div>

    <!-- Antecedentes familiares -->

    <div th:fragment="familyHistory" th:if="${not #lists.isEmpty(familyHistories.content) || familyHistories.isReferred != null}">
        <p class="section-title">Antecedentes familiares</p>
        <div th:if="${personalHistories.isReferred != null && familyHistories.isReferred == false}">
            <p class="section-data">No refiere</p>
        </div>
        <div th:if="${(familyHistories.isReferred == null && not #lists.isEmpty(familyHistories.content)) || familyHistories.isReferred == true}">
            <dl class="section-data" th:each="familyHistory,iter: ${familyHistories.content}">
                <dd><p th:text="${'- ' +familyHistory.snomed.pt}"></p></dd>
            </dl>
        </div>
    </div>

    <!-- Alergias -->

    <div th:fragment="allergies" th:if="${allergies != null && (not #lists.isEmpty(allergies.content) || allergies.isReferred != null)}">
        <p class="section-title">Alergias</p>
        <div th:if="${allergies.isReferred != null && allergies.isReferred == false}">
            <p class="section-data">No refiere</p>
        </div>
        <div th:if="${(allergies.isReferred == null && not #lists.isEmpty(allergies.content)) || allergies.isReferred == true}" class="section-data">
            <dl class="lista" th:each="allergy,iter: ${allergies.content}">
                <dd><p th:text="${'- ' + allergy.snomed.pt}"></p></dd>
                <dl>
                    <dd><strong>Estado: </strong><label  th:text="${allergy.status}"></label></dd>
                    <dd><strong>Verificación: </strong><label  th:text="${allergy.verification}"></label></dd>
                </dl>
            </dl>
        </div>
    </div>

    <!-- Vacunas -->

    <div th:fragment="immunizations" th:if="${not #lists.isEmpty(billableImmunizations)}">
        <p class="section-title">Vacunas aplicadas</p>
        <div>
            <dl class="section-data" th:each="immunization,iter: ${billableImmunizations}">
                <dd><strong>Vacuna</strong><p th:text="${'- ' + immunization.snomed.pt}"></p></dd>
                <dl>
                    <dd><strong th:if="${immunization.administrationDate != null}">Fecha de administración: </strong><label th:if="${immunization.administrationDate != null}" th:text="${immunization.administrationDate}"></label></dd>
                    <dd><strong th:if="${immunization.condition != null}">Condición: </strong><label th:if="${immunization.condition != null}" th:text="${immunization.condition.description}"></label></dd>
                    <dd><strong th:if="${immunization.scheme != null}">Esquema: </strong><label th:if="${immunization.scheme != null}" th:text="${immunization.scheme.description}"></label></dd>
                    <dd><strong th:if="${immunization.dose != null}">Dosis: </strong><label th:if="${immunization.dose != null}" th:text="${immunization.dose.description}"></label></dd>
                    <dd><strong th:if="${immunization.lotNumber != null}">Número de lote: </strong><label th:if="${immunization.lotNumber != null}" th:text="${immunization.lotNumber}"></label></dd>
                    <dd><strong th:if="${immunization.note != null && immunization.note != ''}">Observaciones: </strong><label th:if="${immunization.note != null && immunization.note != ''}" th:text="${immunization.note}"></label></dd>
                </dl>
            </dl>
        </div>
        <div  th:if="${not #lists.isEmpty(nonBillableImmunizations)}">
            <p class="section-title">Vacunas registradas</p>
            <div>
                <dl class="section-data" th:each="immunization,iter: ${nonBillableImmunizations}">
                    <dd><strong>Vacuna</strong><p th:text="${'- ' + immunization.snomed.pt}"></p></dd>
                    <dl>
                        <dd><strong th:if="${immunization.administrationDate != null}">Fecha de administración: </strong><label th:if="${immunization.administrationDate != null}" th:text="${immunization.administrationDate}"></label></dd>
                        <dd><strong th:if="${immunization.condition != null}">Condición: </strong><label th:if="${immunization.condition != null}" th:text="${immunization.condition.description}"></label></dd>
                        <dd><strong th:if="${immunization.scheme != null}">Esquema: </strong><label th:if="${immunization.scheme != null}" th:text="${immunization.scheme.description}"></label></dd>
                        <dd><strong th:if="${immunization.dose != null}">Dosis: </strong><label th:if="${immunization.dose != null}" th:text="${immunization.dose.description}"></label></dd>
                        <dd><strong th:if="${immunization.lotNumber != null}">Número de lote: </strong><label th:if="${immunization.lotNumber != null}" th:text="${immunization.lotNumber}"></label></dd>
                        <dd><strong th:if="${immunization.doctorInfo != null}">Doctor: </strong><label th:if="${immunization.doctorInfo != null}" th:text="${immunization.doctorInfo}"></label></dd>
                        <dd><strong th:if="${immunization.institutionInfo != null}">Institución: </strong><label th:if="${immunization.institutionInfo != null}" th:text="${immunization.institutionInfo}"></label></dd>
                        <dd><strong th:if="${immunization.note != null}">Observaciones: </strong><label th:if="${immunization.note != null}" th:text="${immunization.note}"></label></dd>
                    </dl>
                </dl>
            </div>
        </div>
    </div>

    <!-- Medicación habitual -->

    <div th:fragment="medications (title)" th:if="${not #lists.isEmpty(medications)}">
        <p class="section-title" th:text="${title}"></p>
        <div>
            <dl class="section-data" th:each="medication,iter: ${medications}">
                <dd><p th:text="${'- ' + medication.snomed.pt}"></p></dd>
                <dl>
                    <dd><strong th:if="${medication.note != null}">Observaciones: </strong><label  th:text="${medication.note}"></label></dd>
                </dl>
            </dl>
        </div>
    </div>

    <!-- Otras circunstancias que prolongan la internación -->

    <div th:fragment="otherProblems (title)" th:if="${not #lists.isEmpty(otherProblems)}">
        <div th:if="${cipresFieldsFF}">
            <p class="section-title" th:text="${title}"></p>
            <div>
                <dl class="section-data" th:each="problem,iter: ${otherProblems}">
                    <dd><p th:text="${'- ' + problem.snomed.pt}"></p></dd>
                </dl>
            </div>
        </div>
    </div>

                
    <!-- Causa externa de traumatismo, envenenamiento y otros efectos adversos -->

    <div th:fragment="externalCause" th:if="${externalCause  != null}">
        <div th:if="${cipresFieldsFF}">
            <p class="section-title"> Causa externa de traumatismo, envenenamiento y otros efectos adversos</p>
                <div class="section-data">
                    - Producido por:
                    <strong><label  th:if="${externalCause.externalCauseType  != null}" th:text="${externalCause.externalCauseType.value}"></label></strong>
                    <strong><span  th:if="${externalCause.externalCauseType  == null}">Sin cambios registrados</span></strong><br/>

                    - Lugar donde ocurrió:
                    <strong><label  th:if="${externalCause.eventLocation  != null}" th:text="${externalCause.eventLocation.value}"></label></strong>
                    <strong><span  th:if="${externalCause.eventLocation  == null}">Sin cambios registrados</span></strong><br/>

                    - Como se produjo:
                    <strong><label  th:if="${externalCause.snomed  != null}" th:text="${externalCause.snomed.pt}"></label></strong>
                    <strong><span  th:if="${externalCause.snomed  == null}">Sin cambios registrados</span></strong><br/><br/>
                </div>
        </div>
    </div>

    <!-- Datos del evento obstetrico -->

    <div th:fragment="obstetricEvent" th:if="${obstetricEvent  != null}">
        <div th:if="${cipresFieldsFF}">
            <p class="section-title"> Datos del evento obstétrico </p>
            <div class="section-data">
                <h4> Gestas anteriores </h4>

                - Total de nacimientos anteriores al presente:
                <strong><label  th:if="${obstetricEvent.previousPregnancies  != null}" th:text="${obstetricEvent.previousPregnancies}"></label></strong>
                <strong><span  th:if="${obstetricEvent.previousPregnancies  == null}">Sin cambios registrados</span></strong><br/><br/>

                <h4> Gesta actual </h4>

                - Fecha de terminación del embarazo:
                <strong><label  th:if="${obstetricEvent.currentPregnancyEndDate  != null}" th:text="${#temporals.format(obstetricEvent.currentPregnancyEndDate, 'dd/MM/yyyy')}"></label></strong>
                <strong><span  th:if="${obstetricEvent.currentPregnancyEndDate  == null}">Sin cambios registrados</span></strong><br/>

                - Edad gestacional:
                <strong><label  th:if="${obstetricEvent.gestationalAge  != null}" th:text="${obstetricEvent.gestationalAge}"></label></strong>
                <strong><span  th:if="${obstetricEvent.gestationalAge  == null}">Sin cambios registrados</span></strong><br/>

                - Terminación:
                <strong><label  th:if="${obstetricEvent.pregnancyTerminationType  != null}" th:text="${obstetricEvent.pregnancyTerminationType.value}"></label></strong>
                <strong><span  th:if="${obstetricEvent.pregnancyTerminationType  == null}">Sin cambios registrados</span></strong><br/><br/>

                <div th:if="${not #lists.isEmpty(obstetricEvent.newborns)}">
                    <dl th:each="newborn,iter: ${obstetricEvent.newborns}">
                        <dd><strong>Recien nacido <label th:text="${iter.index+1}"></label></strong></dd>
                        <dl>
                            <dd>Peso al nacer: <label th:text="${newborn.weight}"></label></dd>
                            <dd>Condición al nacer: <label th:text="${newborn.birthConditionType.value}"></label></dd>
                            <dd>Sexo: <label th:text="${newborn.genderId.value}"></label></dd>
                        </dl>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <!-- Signos vitales y factores de riesgo -->

    <div th:fragment="riskFactors" th:if="${riskFactors != null && riskFactors.hasValues}">
        <p class="section-title">Factores de riesgo</p>
        <div class="section-data">
            - Frecuencía cardíaca:
            <strong><span  th:if="${riskFactors.heartRate  == null}">Sin cambios registrados</span></strong>
            <strong><span  th:if="${riskFactors.heartRate  != null}" th:text="${riskFactors.heartRate.value + '/min'} "></span></strong>
            &nbsp;<span th:if="${riskFactors.heartRate != null}" >Fecha de medición: </span>
            <strong><span th:if="${(riskFactors.heartRate != null) &&  (riskFactors.heartRate.effectiveTime != null)}" th:text="${#temporals.format(riskFactors.heartRate.effectiveTime, 'dd-MM-yyyy HH:mm') + ' hs'}"></span></strong><br/>

            - Frecuencía respiratoria:
            <strong><span  th:if="${riskFactors.respiratoryRate  == null}">Sin cambios registrados</span></strong>
            <strong><span  th:if="${riskFactors.respiratoryRate != null}" th:text="${riskFactors.respiratoryRate.value + '/min'}"></span></strong>
            &nbsp;<span th:if="${riskFactors.respiratoryRate != null}" >Fecha de medición: </span>
            <strong><span  th:if="${(riskFactors.respiratoryRate != null) &&  (riskFactors.respiratoryRate.effectiveTime != null)}" th:text="${#temporals.format(riskFactors.respiratoryRate.effectiveTime, 'dd-MM-yyyy HH:mm') + ' hs'}"></span></strong><br/>

            - Tensión arterial (Sistolica/Diastolica):
            <strong><span  th:if="${(riskFactors.systolicBloodPressure == null) &&  (riskFactors.diastolicBloodPressure == null)}">Sin cambios registrados</span></strong>

            <strong><span  th:if="${(riskFactors.systolicBloodPressure != null) &&  (riskFactors.diastolicBloodPressure == null)}" th:text="${riskFactors.systolicBloodPressure.value + '/- mm Hg'}"></span></strong>
            <strong><span  th:if="${(riskFactors.systolicBloodPressure == null) &&  (riskFactors.diastolicBloodPressure != null)}" th:text="${'-/' + riskFactors.diastolicBloodPressure.value + ' mm Hg'}"></span></strong>
            <strong><span  th:if="${(riskFactors.systolicBloodPressure != null) &&  (riskFactors.diastolicBloodPressure != null)}" th:text="${riskFactors.systolicBloodPressure.value + '/' + riskFactors.diastolicBloodPressure.value + ' mm Hg'}"></span></strong>


            &nbsp;<span th:if="${(riskFactors.systolicBloodPressure != null) || (riskFactors.diastolicBloodPressure != null)}" >Fecha de medición: </span>
            <strong><span  th:if="${(riskFactors.systolicBloodPressure != null) &&  (riskFactors.diastolicBloodPressure != null) &&  (riskFactors.systolicBloodPressure.effectiveTime != null)}" th:text="${#temporals.format(riskFactors.systolicBloodPressure.effectiveTime, 'dd-MM-yyyy HH:mm') + ' hs'}"></span></strong>
            <strong><span  th:if="${(riskFactors.systolicBloodPressure != null) &&  (riskFactors.diastolicBloodPressure == null) &&  (riskFactors.systolicBloodPressure.effectiveTime != null)}" th:text="${#temporals.format(riskFactors.systolicBloodPressure.effectiveTime, 'dd-MM-yyyy HH:mm') + ' hs'}"></span></strong>
            <strong><span  th:if="${(riskFactors.systolicBloodPressure == null) &&  (riskFactors.diastolicBloodPressure != null) &&  (riskFactors.diastolicBloodPressure.effectiveTime != null)}" th:text="${#temporals.format(riskFactors.diastolicBloodPressure.effectiveTime, 'dd-MM-yyyy HH:mm') + ' hs'}"></span></strong><br/>

            - Temperatura corporal:
            <strong><span  th:if="${riskFactors.temperature  == null}">Sin cambios registrados</span></strong>
            <strong><span  th:if="${riskFactors.temperature != null}" th:text="${riskFactors.temperature.value  + '°C'}"></span></strong>
            &nbsp;<span th:if="${riskFactors.temperature != null}" >Fecha de medición: </span>
            <strong><span  th:if="${(riskFactors.temperature != null) &&  (riskFactors.temperature.effectiveTime != null)}" th:text="${#temporals.format(riskFactors.temperature.effectiveTime, 'dd-MM-yyyy HH:mm') + ' hs'}"></span></strong><br/>

            - Saturación de oxígeno:
            <strong><span  th:if="${riskFactors.bloodOxygenSaturation  == null}">Sin cambios registrados</span></strong>
            <strong><span  th:if="${riskFactors.bloodOxygenSaturation != null}" th:text="${riskFactors.bloodOxygenSaturation.value+ '%' + 'Hs'}"></span></strong>
            &nbsp;<span th:if="${riskFactors.bloodOxygenSaturation != null}" >Fecha de medición: </span>
            <strong><span  th:if="${(riskFactors.bloodOxygenSaturation != null) &&  (riskFactors.bloodOxygenSaturation.effectiveTime != null)}" th:text="${#temporals.format(riskFactors.bloodOxygenSaturation.effectiveTime, 'dd-MM-yyyy HH:mm') + ' hs'}"></span></strong><br/>

            - Glucemia:
            <strong><span  th:if="${riskFactors.bloodGlucose  == null}">Sin cambios registrados</span></strong>
            <strong><span  th:if="${riskFactors.bloodGlucose != null}" th:text="${riskFactors.bloodGlucose.value + 'Mg/dl'}"></span></strong>
            &nbsp;<span th:if="${riskFactors.bloodGlucose != null}" >Fecha de medición: </span>
            <strong><span  th:if="${(riskFactors.bloodGlucose != null) &&  (riskFactors.bloodGlucose.effectiveTime != null)}" th:text="${#temporals.format(riskFactors.bloodGlucose.effectiveTime, 'dd-MM-yyyy HH:mm') + ' hs'}"></span></strong><br/>

            - Hemoglobina glicosilada:
            <strong><span  th:if="${riskFactors.glycosylatedHemoglobin  == null}">Sin cambios registrados</span></strong>
            <strong><span  th:if="${riskFactors.glycosylatedHemoglobin != null}" th:text="${riskFactors.glycosylatedHemoglobin.value+ '%'}"></span></strong>
            &nbsp;<span th:if="${riskFactors.glycosylatedHemoglobin != null}" >Fecha de medición: </span>
            <strong><span  th:if="${(riskFactors.glycosylatedHemoglobin != null) &&  (riskFactors.glycosylatedHemoglobin.effectiveTime != null)}" th:text="${#temporals.format(riskFactors.glycosylatedHemoglobin.effectiveTime, 'dd-MM-yyyy HH:mm') + ' hs'}"></span></strong><br/>

            - Riesgo cardiovascular:
            <strong><span  th:if="${riskFactors.cardiovascularRisk  == null}">Sin cambios registrados</span></strong>
            <strong><span  th:if="${riskFactors.cardiovascularRisk != null}" th:text="${riskFactors.cardiovascularRisk.value+ '%'}"></span></strong>
            &nbsp;<span th:if="${riskFactors.cardiovascularRisk != null}" >Fecha de medición: </span>
            <strong><span  th:if="${(riskFactors.cardiovascularRisk != null) &&  (riskFactors.cardiovascularRisk.effectiveTime != null)}" th:text="${#temporals.format(riskFactors.cardiovascularRisk.effectiveTime, 'dd-MM-yyyy HH:mm') + ' hs'}"></span></strong><br/>

            <div th:if="${otherRiskFactors != null}">
                <div th:if="${otherRiskFactors.bodyTemperatureId != null}">
                    - Temperatura:
                    <strong><span th:text="${otherRiskFactors.bodyTemperatureDescription}"></span></strong>
                </div>
                <div th:if="${otherRiskFactors.cryingExcessive != null}">
                    - Llanto sin consuelo:
                    <strong><span th:if="${otherRiskFactors.cryingExcessive}" th:text="Si"></span></strong>
                    <strong><span th:if="${!otherRiskFactors.cryingExcessive}" th:text="No"></span></strong>
                </div>
                <div th:if="${otherRiskFactors.muscleHypertoniaId != null}">
                    - Tono muscular:
                    <strong><span th:text="${otherRiskFactors.muscleHypertoniaDescription}"></span></strong>
                </div>
                <div th:if="${otherRiskFactors.respiratoryRetractionId != null}">
                    - Respiracion con tiraje:
                    <strong><span th:text="${otherRiskFactors.respiratoryRetractionDescription}"></span></strong>
                </div>
                <div th:if="${otherRiskFactors.stridor != null}">
                    - Respiración con estridor:
                    <strong><span th:if="${otherRiskFactors.stridor}" th:text="Si"></span></strong>
                    <strong><span th:if="${!otherRiskFactors.stridor}" th:text="No"></span></strong>
                </div>
                <div th:if="${otherRiskFactors.perfusionId != null}">
                    - Perfusión:
                    <strong><span th:text="${otherRiskFactors.perfusionDescription}"></span></strong>
                </div>
            </div>
        </div><br/>
    </div>

    <!-- Observaciones -->

    <div th:fragment="notes-base" th:if="${notes != null && !notes.isEmpty()}">
        <p class="section-title">Observaciones</p>
        <div class="section-data">
            <div class="col-12" th:if="${notes.currentIllnessNote}">
                <strong class="center-padding">Enfermedad actual</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.currentIllnessNote}"></p>
            </div>
            <div class="col-12 " th:if="${notes.physicalExamNote}">
                <strong class="center-padding">Examen físico</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.physicalExamNote}"></p>
            </div>
            <div class="col-12" th:if="${notes.studiesSummaryNote}">
                <strong class="center-padding">Resumen de estudios y procedimientos realizados</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.studiesSummaryNote}"></p>
            </div>
            <div class="col-12" th:if="${notes.evolutionNote}">
                <strong class="center-padding">Evolución</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.evolutionNote}"></p>
            </div>
            <div class="col-12" th:if="${notes.clinicalImpressionNote}">
                <strong class="center-padding">Impresión clinica y plan</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.clinicalImpressionNote}"></p>
            </div>
            <div class="col-12" th:if="${notes.otherNote}">
                <strong class="center-padding">Otras observaciones</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.otherNote}"></p>
            </div>
        </div>
    </div>

    <div th:fragment="notes-epicrisis" th:if="${notes != null && !notes.isEmpty()}">
        <p class="section-title">Observaciones</p>
        <div class="section-data">
            <div class="col-12" th:if="${notes.evolutionNote}">
                <strong class="center-padding">Evolución</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.evolutionNote}"></p>
            </div>
            <div class="col-12" th:if="${notes.studiesSummaryNote}">
                <strong class="center-padding">Resumen de estudios y procedimientos realizados</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.studiesSummaryNote}"></p>
            </div>
            <div class="col-12 " th:if="${notes.physicalExamNote}">
                <strong class="center-padding">Examen físico</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.physicalExamNote}"></p>
            </div>
            <div class="col-12" th:if="${notes.indicationsNote}">
                <strong class="center-padding">Indicaciones de alta</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.indicationsNote}"></p>
            </div>
            <div class="col-12" th:if="${notes.otherNote}">
                <strong class="center-padding">Otras observaciones</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.otherNote}"></p>
            </div>
        </div>
    </div>

    <div th:fragment="notes-outpatient" th:if="${notes != null && !notes.isEmpty()}">
        <p class="section-title">Observaciones</p>
        <div class="section-data">
            <div class="col-12" th:if="${notes.otherNote}">
                <strong class="center-padding">Evolución</strong>
                <p class="center-padding wide_wrapped_text" th:text="${notes.otherNote}"></p>
            </div>
        </div>
    </div>

    <!-- Nota de evolución  -->
    <div th:fragment="evolutionNote" th:if="${notes != null && !notes.isEmpty()}">
        <p class="section-title">Nota de evolución</p>
        <div class="section-data">
            <div class="col-12" th:if="${notes.evolutionNote}">
                <p class="center-padding wide_wrapped_text" th:text="${notes.evolutionNote}"></p>
            </div>
        </div>
    </div>

    <div th:fragment="counterReference" th:if="${notes != null && !notes.isEmpty()}">
        <p class="section-title">Contrarreferencia</p>
        <div class="section-data">
            <div class="col-12" th:if="${notes.evolutionNote}">
                <label class="wide_wrapped_text" th:text="${notes.evolutionNote}"></label>
            </div>
        </div>
    </div>

    <!-- Conclusions image report -->
    <div th:fragment="conclusions">
        <h3>Conclusiones</h3>
        <div th:if="${#lists.isEmpty(conclusions)}">
            <dl>
                <dd><p>Sin conclusiones registradas</p></dd>
            </dl>
        </div>
        <div th:if="${not #lists.isEmpty(conclusions)}">
            <dl th:each="conclusion,iter: ${conclusions}">
                <dd><p  th:text="${'- ' + conclusion.snomed.pt}"></p></dd>
            </dl>
        </div>
    </div>

     <!-- Report  -->
     <div th:fragment="report">
        <h3>Detalle del informe</h3>
        <div class="center-padding wide_wrapped_text">
            [(${notes.evolutionNote})]
        </div>
    </div>

        <!-- Report Image -->
     <div th:fragment="report-image">
        <div class="center-padding wide_wrapped_text">
            [(${evolutionNote})]
        </div>
    </div>

    <!-- Datos Antropométricos parte anestésico -->
    <div th:fragment="antropometicDataAnestheticReport(message)" th:if="${anthropometricData != null && anthropometricData.hasMinimalValues()}">
        <p class="section-title" th:text="${message}"></p>
        <div class="section-data">
            <div th:replace=" :: bloodType"></div>
            <div th:replace=" :: height"></div>
            <div th:replace=" :: weight"></div>
        </div>
    </div>

    <!-- Antecedentes anestésicos -->
    <div th:fragment="anestheticHistory(message)" th:if="${anestheticHistory != null && anestheticHistory.hasStringValues}">
        <p class="section-title" th:text="${message}"></p>
        <div class="section-data">
            <strong>¿El paciente se realizó algún tipo de anestesia previamente?</strong>
            <span th:text="${anestheticHistory.previousAnesthesiaState}"></span>
            <span th:text="${anestheticHistory.anesthesiaZone} ? ${'(' + anestheticHistory.anesthesiaZone + ')'} : _"></span>
        </div>
    </div>

    <!-- Sustancias anestésicas -->
    <div th:fragment="anestheticSubstance(message, anestheticSubstances)" th:if="${anestheticSubstances != null && not #lists.isEmpty(anestheticSubstances)}">
        <p class="section-title" th:text="${message}"></p>
        <div>
            <dl class="section-data" th:each="substance,iter: ${anestheticSubstances}">
                <dd><p class="wide_wrapped_text" th:text="${'- ' + substance.snomed.pt}"></p>
                    <dl>
                        <dd th:if="${substance.viaDescription}">
                            <strong>Vía: </strong><span th:text="${substance.viaDescription}"></span>
                            <span class="wide_wrapped_text" th:text="${substance.viaNote} ? ${' - ' + substance.viaNote} : _"></span>
                        </dd>
                        <dd><strong>Dosis: </strong><span th:text="${substance.dosage.quantity.value}"></span></dd>
                        <dd><strong>Unidad: </strong><span th:text="${substance.dosage.quantity.unit}"></span></dd>
                        <dd th:if="${substance.viaDescription}">
                            <strong>Fecha de administración: </strong>
                            <span th:text="${substance.performedTime} ? ${#temporals.format(substance.performedTime, 'HH:mm') + ' hs.'} : _"></span>
                        </dd>
                    </dl>
                </dd>
            </dl>
        </div>
    </div>

    <!-- Última hora ingesta alimentaria -->
    <div th:fragment="foodInTake(message)" class="section-data" th:if="${foodIntake != null && foodIntake.performedTime != null}">
        <p class="section-title" th:text="${preMedications == null || #lists.isEmpty(preMedications)} ? ${message} : _"></p>
        <strong>Última ingesta de comida: </strong>
        <span th:text="${#temporals.format(foodIntake.performedTime, 'HH:mm') + ' hs.'}"></span>
    </div>

    <!-- Antecedentes (histories) -->
    <div th:fragment="histories(message)" th:if="${not #lists.isEmpty(histories) || (procedureDescription != null && procedureDescription.hasHistoryStringValues())}">
        <p class="section-title" th:text="${message}"></p>
        <div class="section-data">
            <dl th:each="history,iter: ${histories}">
                <dd><p class="wide_wrapped_text" th:text="${'- ' + history.snomed.pt}"></p></dd>
            </dl>
            <dd th:if="${procedureDescription != null}">
                <strong>Observaciones: </strong>
                <p class="wide_wrapped_text" th:text="${procedureDescription.note} ? ${procedureDescription.note} : _"></p>
            </dd>
            <dd th:if="${procedureDescription != null}">
                <strong>ASA: </strong>
                <span th:text="${procedureDescription.asa} ? ${procedureDescription.asa} : _"></span>
            </dd>
        </div>
    </div>

    <!-- Técnicas analgésicas -->
    <div th:fragment="analgesicTechnique(message)" th:if="${analgesicTechniques != null && not #lists.isEmpty(analgesicTechniques)}">
        <p class="section-title" th:text="${message}"></p>
        <div>
            <dl class="section-data" th:each="substance,iter: ${analgesicTechniques}">
                <dd><p class="wide_wrapped_text" th:text="${'- ' + substance.snomed.pt}"></p>
                    <dl>
                        <dd th:if="${substance.injectionNote}">
                            <strong>Zona de inyección: </strong><p class="wide_wrapped_text" th:text="${substance.injectionNote}"></p>
                        </dd>
                        <dd><strong>Dosis: </strong><span th:text="${substance.dosage.quantity.value}"></span></dd>
                        <dd><strong>Unidad: </strong><span th:text="${substance.dosage.quantity.unit}"></span></dd>
                        <dd th:if="${substance.catheter != null}">
                            <strong>Cateter: </strong><span th:text="${substance.catheter} ? Si : No"></span>
                        </dd>
                        <dd th:if="${substance.catheterNote}">
                            <strong>Observaciones: </strong><p class="wide_wrapped_text" th:text="${substance.injectionNote}"></p>
                        </dd>
                    </dl>
                </dd>
            </dl>
        </div>
    </div>

    <!-- Técnicas anestésicas -->
    <div th:fragment="anestheticTechnique(message)" th:if="${anestheticTechniques != null && not #lists.isEmpty(anestheticTechniques)}">
        <p class="section-title" th:text="${message}"></p>
        <div>
            <dl class="section-data" th:each="substance,iter: ${anestheticTechniques}">
                <dd><p class="wide_wrapped_text" th:text="${'- ' + substance.snomed.pt}"></p>
                    <dl>
                        <dd th:if="${substance.techniqueDescription}">
                            <strong>Técnica: </strong><span th:text="${substance.techniqueDescription}"></span>
                        </dd>
                        <dd th:if="${substance.trachealIntubation != null}">
                            <strong>Intubación traqueal: </strong><span th:text="${substance.trachealIntubation} ? Si : No"></span>
                            <span th:text="${substance.trachealIntubationMethodDescription} ? ${' - ' + substance.trachealIntubationMethodDescription} : _"></span>
                        </dd>
                        <dd th:if="${substance.breathingDescription}">
                            <strong>Respiración: </strong><span th:text="${substance.breathingDescription}"></span>
                        </dd>
                        <dd th:if="${substance.circuitDescription}">
                            <strong>Circuito: </strong><span th:text="${substance.circuitDescription}"></span>
                        </dd>
                    </dl>
                </dd>
            </dl>
        </div>
    </div>

    <!-- Procedimientos anestésicos intraquirúrgicos -->
    <div th:fragment="intrasurgicalAnestheticProcedures(message)" th:if="${procedureDescription != null && procedureDescription.hasIntrasurgicalAnestheticProceduresValues()}">
        <p class="section-title" th:text="${message}"></p>
        <div class="section-data">
            <dd th:if="${procedureDescription.venousAccess != null}">
                <strong>Acceso venoso: </strong><span th:text="${procedureDescription.venousAccess} ? Si : No"></span>
            </dd>
            <dd th:if="${procedureDescription.nasogastricTube != null}">
                <strong>Sonda nasogástrica: </strong><span th:text="${procedureDescription.nasogastricTube} ? Si : No"></span>
            </dd>
            <dd th:if="${procedureDescription.urinaryCatheter != null}">
                <strong>Sonda vesical: </strong><span th:text="${procedureDescription.urinaryCatheter} ? Si : No"></span>
            </dd>
        </div>
    </div>

    <!-- Estado al finalizar la anestesia -->
    <div th:fragment="postAnesthesiaStatus(message)" th:if="${postAnesthesiaStatus != null && postAnesthesiaStatus.hasValues()}">
        <p class="section-title" th:text="${message}"></p>
        <div class="section-data">
            <dd th:if="${postAnesthesiaStatus.intentionalSensitivity != null}">
                <strong>Sensibilidad dolorosa: </strong><span th:text="${postAnesthesiaStatus.intentionalSensitivity} ? Si : No"></span>
            </dd>
            <dd th:if="${postAnesthesiaStatus.cornealReflex != null}">
                <strong>Reflejo corneal: </strong><span th:text="${postAnesthesiaStatus.cornealReflex} ? Si : No"></span>
            </dd>
            <dd th:if="${postAnesthesiaStatus.obeyOrders != null}">
                <strong>Obedece órdenes: </strong><span th:text="${postAnesthesiaStatus.obeyOrders} ? Si : No"></span>
            </dd>
            <dd th:if="${postAnesthesiaStatus.talk != null}">
                <strong>Conversa: </strong><span th:text="${postAnesthesiaStatus.talk} ? Si : No"></span>
            </dd>
            <dd th:if="${postAnesthesiaStatus.respiratoryDepression != null}">
                <strong>Depresión respiratoria: </strong><span th:text="${postAnesthesiaStatus.respiratoryDepression} ? Si : No"></span>
            </dd>
            <dd th:if="${postAnesthesiaStatus.circulatoryDepression != null}">
                <strong>Depresión circulatoria: </strong><span th:text="${postAnesthesiaStatus.circulatoryDepression} ? Si : No"></span>
            </dd>
            <dd th:if="${postAnesthesiaStatus.vomiting != null}">
                <strong>Vómitos: </strong><span th:text="${postAnesthesiaStatus.vomiting} ? Si : No"></span>
            </dd>
            <dd th:if="${postAnesthesiaStatus.curated != null}">
                <strong>Curarizado: </strong><span th:text="${postAnesthesiaStatus.curated} ? Si : No"></span>
            </dd>
            <dd th:if="${postAnesthesiaStatus.trachealCannula != null}">
                <strong>Cánula traqueal: </strong><span th:text="${postAnesthesiaStatus.trachealCannula} ? Si : No"></span>
            </dd>
            <dd th:if="${postAnesthesiaStatus.pharyngealCannula != null}">
                <strong>Cánula faringea: </strong><span th:text="${postAnesthesiaStatus.pharyngealCannula} ? Si : No"></span>
            </dd>
            <dd th:if="${postAnesthesiaStatus.internment != null}">
                <strong>Se interna: </strong><span th:text="${postAnesthesiaStatus.internment} ? Si : No"></span>
                <span th:text="${postAnesthesiaStatus.internmentPlace} ? ${' - ' + postAnesthesiaStatus.internmentPlace.getDescription()} : _"></span>
            </dd>
            <dd th:if="${postAnesthesiaStatus.note}">
                <strong>Observaciones: </strong><p class="wide_wrapped_text" th:text="${postAnesthesiaStatus.note}"></p>
            </dd>
        </div>
    </div>

    <!-- Signos vitales durante la anestesia -->
    <div th:fragment="vitalSignsDuringAnesthesia(message, chartData)"
         th:if="${(procedureDescription != null && procedureDescription.hasTimeValues())
         || chartData != null
         || (measuringPoints != null && not #lists.isEmpty(measuringPoints))}">
        <p class="section-title" th:text="${message}"></p>
        <div class="section-data" th:if="${procedureDescription != null && procedureDescription.hasTimeValues()}" th:with="pd=${procedureDescription}">
            <dd th:if="${pd.anesthesiaStartLocalDate != null || pd.anesthesiaStartLocalTime != null}">
                <strong>Comienzo anestesia: </strong>
                <span th:text="${pd.anesthesiaStartLocalDate} ? ${#temporals.format(pd.anesthesiaStartLocalDate, 'dd/MM/yyyy')} : _"> </span>
                <span th:text="${pd.anesthesiaStartLocalDate != null && pd.anesthesiaStartLocalTime != null} ? ' - ' : _"> </span>
                <span th:text="${pd.anesthesiaStartLocalTime} ? ${#temporals.format(pd.anesthesiaStartLocalTime, 'HH:mm') + ' hs.'} : _"> </span>
            </dd>
            <dd th:if="${pd.anesthesiaEndLocalDate != null || pd.anesthesiaEndLocalTime != null}">
                <strong>Fin anestesia: </strong>
                <span th:text="${pd.anesthesiaEndLocalDate} ? ${#temporals.format(pd.anesthesiaEndLocalDate, 'dd/MM/yyyy')} : _"> </span>
                <span th:text="${pd.anesthesiaEndLocalDate != null && pd.anesthesiaEndLocalTime != null} ? ' - ' : _"> </span>
                <span th:text="${pd.anesthesiaEndLocalTime} ? ${#temporals.format(pd.anesthesiaEndLocalTime, 'HH:mm') + ' hs.'} : _"> </span>
            </dd>
            <dd th:if="${pd.surgeryStartLocalDate != null || pd.surgeryStartLocalTime != null}">
                <strong>Comienzo cirugía: </strong>
                <span th:text="${pd.surgeryStartLocalDate} ? ${#temporals.format(pd.surgeryStartLocalDate, 'dd/MM/yyyy')} : _"> </span>
                <span th:text="${pd.surgeryStartLocalDate != null && pd.surgeryStartLocalTime != null} ? ' - ' : _"> </span>
                <span th:text="${pd.surgeryStartLocalTime} ? ${#temporals.format(pd.surgeryStartLocalTime, 'HH:mm') + ' hs.'} : _"> </span>
            </dd>
            <dd th:if="${pd.surgeryEndLocalDate != null || pd.surgeryEndLocalTime != null}">
                <strong>Fin cirugía: </strong>
                <span th:text="${pd.surgeryEndLocalDate} ? ${#temporals.format(pd.surgeryEndLocalDate, 'dd/MM/yyyy')} : _"> </span>
                <span th:text="${pd.surgeryEndLocalDate != null && pd.surgeryEndLocalTime != null} ? ' - ' : _"> </span>
                <span th:text="${pd.surgeryEndLocalTime} ? ${#temporals.format(pd.surgeryEndLocalTime, 'HH:mm') + ' hs.'} : _"> </span>
            </dd>
        </div>
        <div th:if="${chartData != null}">
            <img class="graph-container" th:src="${chartData}" alt=""/>
        </div>
        <div th:if="${measuringPoints != null && not #lists.isEmpty(measuringPoints)}">
            <div class="divider">
                <hr />
            </div>
            <dl class="section-data" th:each="point,iter: ${measuringPoints}">
                <dd>
                    <strong><span th:text="'Medición ' + ${iter.index+1} +' (' + ${#temporals.format(point.localDate, 'dd/MM/yyyy')} + ' - ' + ${#temporals.format(point.localTime, 'HH:mm')} + ' hs.)'"></span></strong>
                </dd>
                <dd th:if="${point.hasPointValues()}">
                    <strong>TA Max: </strong><span th:text="${point.bloodPressureMax} ? ${point.bloodPressureMax + 'mmHg'} : '-'"></span>
                    <strong> TA Min: </strong><span th:text="${point.bloodPressureMin} ? ${point.bloodPressureMin + 'mmHg'} : '-'"></span>
                    <strong> Pulso: </strong><span th:text="${point.bloodPulse} ? ${point.bloodPulse + 'lat/min'} : '-'"></span>
                    <strong> Saturación: </strong><span th:text="${point.o2Saturation} ? ${point.o2Saturation + '%'} : '-'"></span>
                    <strong> End Tidal CO2: </strong><span th:text="*{point.co2EndTidal}?: '-'"></span>
                </dd>
                <div class="divider">
                    <hr />
                </div>
            </dl>
        </div>
    </div>


</body>
<footer th:fragment="footer">
    <div class="footer">
        <hr class="line"></hr>
        <img style="width: 118px; height: 21px;" th:src="${'data:image/jpeg;charset=utf-8;base64,' + appLogo}" alt=""></img>
    </div>
</footer>
</html>