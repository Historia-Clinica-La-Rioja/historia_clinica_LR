databaseChangeLog: 
    - logicalFilePath: incrementales-v2_25

    - changeSet:
        id: addColumn_closest_service
        author: lmanterola
        changes:
          - addColumn:
              tableName: hierarchical_unit
              columns:
                - column:
                    name: closest_service_id
                    type: int
          - addForeignKeyConstraint:
              baseColumnNames: closest_service_id
              baseTableName: hierarchical_unit
              constraintName: FK_closest_service_id
              onDelete: NO ACTION
              onUpdate: NO ACTION
              referencedColumnNames: id
              referencedTableName: hierarchical_unit
              validate: true

    - changeSet:
        id: role-api_anexo-level-change
        context: "!schema-only"
        author: efernandez
        changes:
          - sql:
              sql: |-
                UPDATE user_role SET institution_id = -1 WHERE role_id = 47;

    - changeSet:
        id: add-column-local_viewer_url-to-pac_server_image_lvl
        author: fzudaire
        changes:
            - addColumn:
                tableName: pac_server_image_lvl
                columns:
                    - column:
                        name: local_viewer_url
                        type: varchar(128)
                        constraints:
                            nullable: true

    - changeSet:
        id: createTable-institution_responsibility_area
        comment: Create table institution_responsibility_area
        author: mmalyvarni
        changes:
          - createTable:
              tableName: institution_responsibility_area
              columns:
                - column:
                    name: institution_id
                    type: int
                    constraints:
                      nullable: false
                      foreignKeyName: FK_institution_responsibility_area_institution_id
                      references: institution(id)
                - column:
                    name: order_id
                    type: smallint
                    constraints:
                      nullable: false
                - column:
                    name: latitude
                    type: float
                    constraints:
                      nullable: false
                - column:
                    name: longitude
                    type: float
                    constraints:
                      nullable: false
          - addPrimaryKey:
              clustered: true
              columnNames: institution_id, order_id
              constraintName: PK_institution_responsibility_area
              tableName: institution_responsibility_area
              validate: true

    - changeSet:
        id: insert-alta-hospitalaria-discharge-type-in-table-discharge_type
        author: tomasbecher
        changes:
          - sql:
              sql: |-               
                INSERT INTO discharge_type VALUES (15, 'Alta hospitalaria', false, true);

    - changeSet:
        id: emergency_care_discharge-addObservationColumn
        comment: Create column observation in table emergency_care_discharge
        author: tomasbecher
        changes:
          - addColumn:
              columns:
                - column:
                    name: observation
                    type: text
              tableName: emergency_care_discharge
    
    - changeSet:
        id: addColumn_massive_retry
        author: amurrie
        changes:
          - addColumn:
              tableName: orchestrator
              columns:
                - column:
                    constraints:
                      nullable: false
                    name: massive_retry
                    type: boolean
                    defaultValue: ${boolean.false}

    - changeSet:
        id: createIndexPersonId-person_file
        author: fsimaro
        dbms: postgresql
        changes:
          - sql:
              sql: |-
                CREATE INDEX IF NOT EXISTS "IDX_person_file_person_id" ON person_file(person_id);

    - changeSet:
        id: createIndexSignatureStatusId-document_file
        author: fsimaro
        dbms: postgresql
        changes:
          - sql:
              sql: |-
                CREATE INDEX IF NOT EXISTS "IDX_document_file_signature_status_id" ON document_file(signature_status_id);

    - changeSet:
        id: createIndexDocumentId-outpatient_consultation
        author: fsimaro
        dbms: postgresql
        changes:
          - sql:
              sql: |-
                CREATE INDEX IF NOT EXISTS "IDX_outpatient_consultation_document_id" ON outpatient_consultation (document_id);

    - changeSet:
        id: delete-duplicated-indexes
        author: fsimaro
        dbms: postgresql
        changes:
          - sql:
              sql: |-
                DROP INDEX IF EXISTS "IDX_appointment_assn_appointment_id";
                DROP INDEX IF EXISTS "IDX_document_health_condition_document_id";
                DROP INDEX IF EXISTS "IDX_document_health_condition_health_condition_id";
                ALTER TABLE document_prosthesis DROP CONSTRAINT "UQ_document_id_document_prosthesis";
                ALTER TABLE user_key DROP CONSTRAINT "UQ_key";

        
    - changeSet:
        id: appointment_patient_identity_accreditation_status-createTable
        comment: Create table appointment_patient_identity_accreditation_status
        author: mmalyvarni
        changes:
          - createTable:
              tableName: appointment_patient_identity_accreditation_status
              columns:
                - column:
                    constraints:
                      primaryKey: true
                      primaryKeyName: PK_appointment_patient_identity_accreditation_status
                      references: appointment(id)
                      foreignKeyName: FK_appointment_patient_identity_accreditation_status_appointment
                    name: appointment_id
                    type: int
                - column:
                    constraints:
                      nullable: false
                    name: patient_identity_accreditation_status_id
                    type: smallint
                - column:
                    name: patient_identification_hash
                    type: varchar(255)

    - changeSet:
        id: update-notes-in-table-triage
        author: tomasbecher
        changes:
          - modifyDataType:
              columnName:  notes
              newDataType:  text
              tableName:  triage
