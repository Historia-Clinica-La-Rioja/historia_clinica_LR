databaseChangeLog: 
    - logicalFilePath: incrementales-v2_26 

    - changeSet:
          id: update-datatype-id-appointment_order_image
          context: "!schema-only"
          author: mromero
          preConditions:
              - onFail: CONTINUE
              - onError: CONTINUE
              - sqlCheck:
                    expectedResult: "SMALLINT"
                    sql: SELECT data_type FROM information_schema.columns WHERE table_name='appointment_order_image' AND column_name='id';
          changes:
              - sql:
                    sql: |-
                        ALTER TABLE appointment_order_image ALTER COLUMN id SET DATA TYPE BIGINT;
    
    - changeSet:
        id: parameterized_form-createTable
        comment: Create table parameterized_form
        author: jvaldez
        changes:
          - createTable:
              tableName: parameterized_form
              columns:
                - column:
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                      primaryKeyName: PK_parameterized_form
                    name: id
                    type: int
                - column:
                    constraints:
                      nullable: false
                    name: name
                    type: varchar(255)
                - column:
                    constraints:
                      nullable: false
                    name: status_id
                    type: smallint
                    defaultValue: 1
                - column:
                    constraints:
                      nullable: false
                    name: outpatient_enabled
                    type: boolean
                    defaultValue: ${boolean.false}
                - column:
                    constraints:
                      nullable: false
                    name: internment_enabled
                    type: boolean
                    defaultValue: ${boolean.false}
                - column:
                    constraints:
                      nullable: false
                    name: emergency_care_enabled
                    type: boolean
                    defaultValue: ${boolean.false}
                - column:
                    constraints:
                      nullable: false
                    name: created_by
                    type: int
                    defaultValue: -1
                - column:
                    constraints:
                      nullable: false
                    name: updated_by
                    type: int
                    defaultValue: -1
                - column:
                    constraints:
                      nullable: false
                    name: created_on
                    type: datetime
                    defaultValueDate: ${date.now}
                - column:
                    constraints:
                      nullable: false
                    name: updated_on
                    type: datetime
                    defaultValueDate: ${date.now}
                - column:
                    constraints:
                      nullable: false
                    name: deleted
                    type: BOOLEAN
                    defaultValue: ${boolean.false}
                - column:
                    name: deleted_by
                    type: int
                - column:
                    name: deleted_on
                    type: datetime

    - changeSet:
        id: parameterized_form_parameter-createTable
        comment: Create table parameterized_form_parameter
        author: jvaldez
        changes:
          - createTable:
              tableName: parameterized_form_parameter
              columns:
                - column:
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                      primaryKeyName: PK_parameterized_form_parameter
                    name: id
                    type: int
                - column:
                    name: parameterized_form_id
                    type: int
                    constraints:
                      nullable: false
                      references: parameterized_form(id)
                      foreignKeyName: FK_parameterized_form_parameter_form_id
                - column:
                    name: parameter_id
                    type: int
                    constraints:
                      nullable: false
                      references: parameter(id)
                      foreignKeyName: FK_parameterized_form_parameter_parameter_id
                - column:
                    constraints:
                      nullable: false
                    name: order_number
                    type: smallint

    - changeSet:
        id: report_queue-createTable
        comment: Create table report_queue
        author: sperruolo
        changes:
          - createTable:
              tableName: report_queue
              columns:
                - column:
                    constraints:
                      primaryKey: true
                      primaryKeyName: PK_report_queue
                    name: id
                    type: int
                    autoIncrement: true
                - column:
                    name: created_on
                    type: datetime
                    constraints:
                      nullable: false
                    defaultValueDate: ${date.now}
                - column:
                    name: generated_on
                    type: datetime
                    constraints:
                      nullable: true
                - column:
                    name: generated_error
                    type: varchar(256)
                    constraints:
                      nullable: true
                - column:
                    name: file_id
                    type: bigint
                    constraints:
                      nullable: true


    - changeSet:
        id: report_queue_institution-createTable
        comment: Create table report_queue_institution
        author: sperruolo
        changes:
          - createTable:
              tableName: report_queue_institution
              columns:
                - column:
                    constraints:
                      primaryKey: true
                      primaryKeyName: PK_report_queue_institution
                    name: id
                    type: int
                - column:
                    name: report_type
                    type: varchar(30)
                    constraints:
                      nullable: false
                - column:
                    name: institution_id
                    type: int
                    constraints:
                      nullable: false
                - column:
                    name: date_start
                    type: date
                    constraints:
                      nullable: false
                - column:
                    name: date_end
                    type: date
                    constraints:
                      nullable: false
                - column:
                    name: clinical_specialty_id
                    type: int
                    constraints:
                      nullable: true
                - column:
                    name: doctor_id
                    type: int
                    constraints:
                      nullable: true
                - column:
                    name: hierarchical_unit_type_id
                    type: int
                    constraints:
                      nullable: true
                - column:
                    name: hierarchical_unit_id
                    type: int
                    constraints:
                      nullable: true
                - column:
                    name: include_hierarchical_unit_descendants
                    type: boolean
                    constraints:
                      nullable: true
                - column:
                    name: appointment_state_id
                    type: smallint
                    constraints:
                      nullable: true

    - changeSet:
        id: medicine_group_medicine-createTable
        comment: Create table medicine_group_medicine
        author: fsimaro
        changes:
          - createTable:
              tableName: medicine_group_medicine
              columns:
                - column:
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                      primaryKeyName: PK_medicine_group_medicine
                    name: id
                    type: int
                - column:
                    constraints:
                      references: medicine_group(id)
                      foreignKeyName: FK_medicine_group_medicine_medicine_group_id
                      nullable: false
                    name: medicine_group_id
                    type: int
                - column:
                    constraints:
                      references: medicine_financing_status(id)
                      foreignKeyName: FK_medicine_group_medicine_medicine_id
                      nullable: false
                    name: medicine_id
                    type: int
                - column:
                    constraints:
                      nullable: false
                    name: created_by
                    type: int
                    defaultValue: -1
                - column:
                    constraints:
                      nullable: false
                    name: created_on
                    type: datetime
                    defaultValueDate: ${date.now}
                - column:
                    constraints:
                      nullable: false
                    name: updated_by
                    type: int
                    defaultValue: -1
                - column:
                    constraints:
                      nullable: false
                    name: updated_on
                    type: datetime
                    defaultValueDate: ${date.now}
                - column:
                    constraints:
                      nullable: false
                    name: deleted
                    type: BOOLEAN
                    defaultValue: ${boolean.false}
                - column:
                    name: deleted_by
                    type: INTEGER
                - column:
                    name: deleted_on
                    type: DATETIME

    - changeSet:
        id: medicine_group_problem-createTable
        comment: Create table medicine_group_problem
        author: fsimaro
        changes:
          - createTable:
              tableName: medicine_group_problem
              columns:
                - column:
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                      primaryKeyName: PK_medicine_group_problem
                    name: id
                    type: int
                - column:
                    constraints:
                      references: medicine_group(id)
                      foreignKeyName: FK_medicine_group_problem_medicine_group_id
                      nullable: false
                    name: medicine_group_id
                    type: int
                - column:
                    constraints:
                      references: snomed(id)
                      foreignKeyName: FK_medicine_group_problem_problem_id
                      nullable: false
                    name: problem_id
                    type: int
                - column:
                    constraints:
                      nullable: false
                    name: created_by
                    type: int
                    defaultValue: -1
                - column:
                    constraints:
                      nullable: false
                    name: created_on
                    type: datetime
                    defaultValueDate: ${date.now}
                - column:
                    constraints:
                      nullable: false
                    name: updated_by
                    type: int
                    defaultValue: -1
                - column:
                    constraints:
                      nullable: false
                    name: updated_on
                    type: datetime
                    defaultValueDate: ${date.now}
                - column:
                    constraints:
                      nullable: false
                    name: deleted
                    type: BOOLEAN
                    defaultValue: ${boolean.false}
                - column:
                    name: deleted_by
                    type: INTEGER
                - column:
                    name: deleted_on
                    type: DATETIME

    - changeSet:
        id: addColumn-all_diagnoses-medicine_group
        author: fsimaro
        changes:
          - addColumn:
              tableName: medicine_group
              columns:
                - column:
                    constraints:
                      nullable: false
                    name: all_diagnoses
                    type: boolean
                    defaultValue: ${boolean.true}

    - changeSet:
        id: addColumn-new_id-medication_statement_commercial
        author: mmalyvarni
        changes:
          - addColumn:
              tableName: medication_statement_commercial
              columns:
                - column:
                    autoIncrement: true
                    name: new_id
                    type: int

    - changeSet:
        id: drop-id-medication_statement_commercial
        author: mmalyvarni
        changes:
          - renameColumn:
              columnDataType: int
              oldColumnName: id
              newColumnName: medication_statement_id
              tableName: medication_statement_commercial
          - dropPrimaryKey:
              constraintName: PK_medication_statement_commercial
              dropIndex: true
              tableName: medication_statement_commercial

    - changeSet:
        id: adapt-id-medication_statement_commercial
        comment: Adapta el id de la tabla medication_statement_commercial
        author: mmalyvarni
        changes:
          - renameColumn:
              columnDataType: int
              newColumnName: id
              oldColumnName: new_id
              tableName: medication_statement_commercial
          - addPrimaryKey:
              columnNames: id
              constraintName: PK_medication_statement_commercial
              tableName: medication_statement_commercial

    - changeSet:
        id: dropView-v_clinic_history_13
        author: fsimaro
        dbms: "postgresql"
        changes:
          - dropView:
              viewName: v_clinic_history

    - changeSet:
        id: update-triage_category-name-length
        author: fsimaro
        changes:
          - modifyDataType:
              columnName:  name
              newDataType:  varchar(25)
              tableName:  triage_category

    - changeSet:
        id: triage_category_modify-data
        comment: Carga de datos triage_category
        author: fsimaro
        context: "!schema-only"
        changes:
          - sql:
              sql: |-
                UPDATE triage_category SET name = 'Nivel 1', color_code = '#F00' WHERE id = 1;
                UPDATE triage_category SET name = 'Nivel 2', color_code = '#FF5C02' WHERE id = 2;
                UPDATE triage_category SET name = 'Nivel 3', color_code = '#ECBE00' WHERE id = 3;
                UPDATE triage_category SET name = 'Nivel 4', color_code = '#009B68' WHERE id = 4;
                UPDATE triage_category SET name = 'Nivel 5', color_code = '#3F4B9D' WHERE id = 5;
                UPDATE triage_category SET name = 'Triage pendiente', color_code = '#D5D5D5' WHERE id = 6;

    - changeSet:
        id: createView-v_clinic_history_14
        author: fsimaro
        changes:
          - sqlFile:
              encoding: UTF-8
              path: data/create_v_clinic_history.sql
              relativeToChangelogFile: true
              splitStatements: false

    - changeSet:
        id: result_studies-create-table
        comment: Create table result_studies
        author: amurrie
        changes:
          - createTable:
              tableName: result_studies
              columns:
                - column:
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                      primaryKeyName: PK_result_studies
                    name: id
                    type: int
                - column:
                    constraints:
                      nullable: false
                    name: id_move
                    type: int
                - column:
                    constraints:
                      nullable: false
                    name: appointment_id
                    type: int
                - column:
                    constraints:
                      nullable: false
                    name: patient_id
                    type: varchar(80)
                - column:
                    constraints:
                      nullable: false
                    name: patient_name
                    type: varchar(80)
                - column:
                    constraints:
                      nullable: true
                    name: study_date
                    type: date
                - column:
                    constraints:
                      nullable: true
                    name: study_time
                    type: time
                - column:
                    constraints:
                      nullable: false
                    name: modality
                    type: varchar(80)
                - column:
                    constraints:
                      nullable: false
                    name: study_instance_uid
                    type: varchar(80)
                - column:
                    constraints:
                      nullable: false
                    name: audit_date
                    type: date
          - addForeignKeyConstraint:
              baseColumnNames: appointment_id
              baseTableName: result_studies
              constraintName: FK_result_studies_appointment_id
              onDelete: NO ACTION
              onUpdate: NO ACTION
              referencedColumnNames: id
              referencedTableName: appointment
              validate: true
          - addForeignKeyConstraint:
              baseColumnNames: id_move
              baseTableName: result_studies
              constraintName: FK_result_studies_id_move
              onDelete: NO ACTION
              onUpdate: NO ACTION
              referencedColumnNames: id
              referencedTableName: move_studies
              validate: true

    - changeSet:
        id: addColumn_find_studies
        author: amurrie
        changes:
          - addColumn:
              tableName: orchestrator
              columns:
                - column:
                    constraints:
                      nullable: false
                    name: find_studies
                    type: boolean
                    defaultValue: ${boolean.false}
