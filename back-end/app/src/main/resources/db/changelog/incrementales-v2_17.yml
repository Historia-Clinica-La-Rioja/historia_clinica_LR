databaseChangeLog: 
    - logicalFilePath: incrementales-v2_17

    - changeSet:
        id: update_violence_report_text_lengths
        author: mmalyvarni
        changes:
          - sql:
              sql: |-
                ALTER TABLE violence_report_keeper ALTER COLUMN other_relationship_with_victim TYPE varchar(30) USING other_relationship_with_victim::varchar;
                ALTER TABLE violence_report_aggressor ALTER COLUMN other_relationship_with_victim TYPE varchar(30) USING other_relationship_with_victim::varchar;
                ALTER TABLE health_system_organization_coordination ALTER COLUMN other_health_system_organization TYPE varchar(100) USING other_health_system_organization::varchar;
                ALTER TABLE health_institution_organization_coordination ALTER COLUMN other_health_institution_organization TYPE varchar(100) USING other_health_institution_organization::varchar;
                ALTER TABLE institution_report_place ALTER COLUMN other_report_place TYPE varchar(100) USING other_report_place::varchar;
                ALTER TABLE violence_report ALTER COLUMN observations TYPE text USING observations::text;

    - changeSet:
        id: violence_report-add-institution_id-column
        comment: Add institution_id column to violence_report table
        author: mmalyvarni
        changes:
          - addColumn:
              tableName: violence_report
              columns:
                - column:
                    constraints:
                      nullable: false
                    name: institution_id
                    type: int
                    defaultValue: -1

    - changeSet:
        id: set-snomed_group-ecl-text-data-type-default
        author: mmalyvarni
        changes:
          - sql:
              sql: |-
                ALTER TABLE snomed_group ALTER COLUMN ecl TYPE text USING ecl::text;

    - changeSet:
        id: rollback-odontology-problems-problem_id-health_condition
        author: mromero
        context: "!schema-only"
        changes:
          - sql:
              sql: |-
                UPDATE health_condition hc
                    SET problem_id = '55607006'
                    WHERE EXISTS (
                        SELECT 1
                        FROM document_health_condition dhc
                        JOIN document d on (dhc.document_id = d.id)
                        WHERE dhc.health_condition_id = hc.id
                        AND d.source_type_id = 6
                        AND hc.problem_id = '00000002'
                    );

    - changeSet:
        id: violence_report_situation_history-createTable
        comment: Create table violence_report_situation_history
        author: mmalyvarni
        changes:
          - createTable:
              tableName: violence_report_situation_history
              columns:
                - column:
                    constraints:
                      nullable: false
                      references: violence_report(id)
                      foreignKeyName: FK_violence_report
                      primaryKey: true
                      primaryKeyName: PK_violence_report_situation_history
                    name: report_id
                    type: int
                - column:
                    constraints:
                      nullable: false
                    name: old_situation_id
                    type: smallint

    - changeSet:
          id: document_type-anesthetic_report
          author: mromero
          context: "!schema-only"
          changes:
              - sql:
                    sql: |-
                        INSERT INTO document_type VALUES (20, 'Parte anest√©sico');
